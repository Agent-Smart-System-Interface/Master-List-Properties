<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DIRECT HUB - PROPERTIES</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Kanit',sans-serif}
  </style>
</head>

<body class="bg-slate-50">
  <div class="max-w-6xl mx-auto px-4 py-8">

    <!-- Header -->
    <div class="flex items-start justify-between gap-4 mb-8">
      <div>
        <h1 class="text-5xl md:text-6xl font-black italic tracking-tight text-slate-900">DIRECT HUB</h1>
        <p class="text-blue-700 font-bold italic text-xl mt-1">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</p>
      </div>

      <button class="w-14 h-14 rounded-2xl bg-white shadow flex items-center justify-center text-2xl"
              title="Profile">
        üë§
      </button>
    </div>

    <!-- Cards -->
    <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></div>

    <!-- Loading -->
    <div id="loading" class="text-center text-slate-400 font-bold py-10">Loading...</div>
  </div>

<script>
  // ‚úÖ ‡πÉ‡∏ä‡πâ API ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÉ‡∏ô edit.html
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  const urlParams = new URLSearchParams(location.search);
  const PROJECT = urlParams.get("project") || "Project_0";

  const fmtPrice = (v) => {
    const n = Number(String(v||"").replace(/,/g,""));
    if (!isFinite(n) || n === 0) return "‡∏ø0";
    return "‡∏ø" + n.toLocaleString("en-US");
  };

  const safe = (v) => (v === null || v === undefined) ? "" : String(v);

  function statusClass(status){
    const s = String(status||"").toLowerCase();
    if (s.includes("available")) return "bg-emerald-100 text-emerald-700";
    if (s.includes("under")) return "bg-sky-100 text-sky-700";
    if (s.includes("reserved")) return "bg-amber-100 text-amber-700";
    if (s.includes("sold")) return "bg-rose-100 text-rose-700";
    return "bg-slate-100 text-slate-700";
  }

  async function load(){
    const loading = document.getElementById("loading");
    const cards = document.getElementById("cards");

    try{
      const res = await fetch(`${API_URL}?mode=getUnitList&project=${encodeURIComponent(PROJECT)}&t=${Date.now()}`);
      const list = await res.json();

      if (!Array.isArray(list)) {
        throw new Error(list && list.error ? list.error : "Invalid data");
      }

      loading.classList.add("hidden");
      cards.innerHTML = list.map(item => {
        const id = safe(item.id);
        const plot = safe(item.plot); // ‚úÖ ‡πÄ‡∏ä‡πà‡∏ô Z-3 (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
        const img = safe(item.thumbnail) || "https://via.placeholder.com/800x600?text=No+Image";

        // ‚úÖ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á
        const bed = safe(item.bedrooms);
        const bath = safe(item.bathrooms);
        const landSqw = safe(item.landSqw);
        const livingSqm = safe(item.livingSqm);
        const price = fmtPrice(item.price);

        // ‚úÖ ‡∏™‡πÄ‡∏ï‡∏ï‡∏±‡∏™‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
        const status = safe(item.status);

        const detailLink = `details.html?id=${encodeURIComponent(id)}&project=${encodeURIComponent(PROJECT)}`;

        return `
          <div class="bg-white rounded-[2.5rem] shadow-xl overflow-hidden">

            <!-- Image -->
            <div class="relative">
              <img src="${img}" class="w-full h-72 object-cover" alt="${id}" />

              <!-- ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1: ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Z-3 (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ Plot / ‡πÑ‡∏°‡πà‡∏°‡∏µ HP-Z003) -->
              <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-4 py-2 rounded-full font-black italic text-slate-900">
                ${plot}
              </div>

              <!-- ‚ùå ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 3: ‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏î‡∏á‡∏ñ‡∏π‡∏Å‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß -->
            </div>

            <!-- Body -->
            <div class="p-6">

              <!-- ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ ‡πÅ‡∏™‡∏î‡∏á Bed/Bath/‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà/‡πÅ‡∏•‡∏∞‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô Status -->
              <div class="flex flex-wrap items-center gap-2 mb-4">
                <span class="px-3 py-2 rounded-xl bg-slate-100 font-bold text-slate-700">üõè ${bed}</span>
                <span class="px-3 py-2 rounded-xl bg-slate-100 font-bold text-slate-700">üõÅ ${bath}</span>
                <span class="px-3 py-2 rounded-xl bg-slate-100 font-bold text-slate-700">üìê ${landSqw} sq.w</span>
                <span class="px-3 py-2 rounded-xl bg-slate-100 font-bold text-slate-700">üè† ${livingSqm} sqm</span>

                <span class="ml-auto px-4 py-2 rounded-full font-extrabold ${statusClass(status)}">
                  ${status || "-"}
                </span>
              </div>

              <!-- ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 4: ‡∏£‡∏≤‡∏Ñ‡∏≤ -->
              <div class="text-5xl font-black italic tracking-tight text-slate-900 mb-1">${price}</div>
              <div class="text-slate-400 font-bold">UNIT: ${id}</div>

              <!-- Button -->
              <a href="${detailLink}"
                 class="mt-6 block text-center bg-slate-900 text-white py-5 rounded-[2rem] font-black italic tracking-widest
                        hover:bg-blue-700 transition">
                VIEW FULL DETAILS
              </a>
            </div>
          </div>
        `;
      }).join("");

    }catch(err){
      loading.classList.remove("hidden");
      loading.innerText = "Error: " + err.message;
    }
  }

  load();
</script>
</body>
</html>
