<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>smart properties system</title>

  <style>
    :root{
      --line-bg:#8CABD9;
      --cloud-a:rgba(244,252,255,.26);
      --cloud-b:rgba(244,252,255,.18);
      --chat-green:#9DE593;
      --line-green:#06c755;
      --text:#111827;
      --muted:rgba(17,24,39,.55);
      --card:#ffffff;
      --stroke:rgba(0,0,0,.06);
      --shadow:0 10px 26px rgba(0,0,0,.10);
      --radius:28px;
      --font:"LINE Seed Sans TH","LINE Seed Sans","Noto Sans Thai","Noto Sans Thai UI",
              system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:var(--line-bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* LINE-like clouds (‡∏ö‡∏≤‡∏á ‡πÜ) */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(120px 80px at 12% 22%, var(--cloud-a) 0 60%, transparent 61%),
        radial-gradient(160px 100px at 30% 24%, var(--cloud-a) 0 58%, transparent 59%),
        radial-gradient(130px 90px at 50% 20%, var(--cloud-b) 0 56%, transparent 57%),
        radial-gradient(200px 120px at 85% 28%, var(--cloud-a) 0 56%, transparent 57%),
        radial-gradient(160px 110px at 78% 62%, var(--cloud-b) 0 56%, transparent 57%),
        radial-gradient(220px 140px at 18% 78%, var(--cloud-a) 0 56%, transparent 57%),
        radial-gradient(180px 120px at 62% 86%, var(--cloud-b) 0 56%, transparent 57%);
    }

    .wrap{
      max-width:420px;
      margin:0 auto;
      padding:16px 14px 22px;
    }

    /* Top bar feel */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      padding:10px 12px;
      margin:0 -14px 12px;
      background:rgba(140,171,217,.70);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.18);
    }
    .titleRow{display:flex; gap:10px; align-items:center}
    .logoDot{
      width:34px; height:34px;
      border-radius:12px;
      background:rgba(255,255,255,.85);
      box-shadow:0 6px 14px rgba(0,0,0,.10);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      letter-spacing:.2px;
    }
    h1{margin:0; font-size:18px; font-weight:900}
    .sub{margin:4px 0 0; font-size:12px; font-weight:700; color:rgba(17,24,39,.65)}

    .panel{
      background:rgba(255,255,255,.94);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    .row{display:flex; gap:10px; align-items:center}
    .selbox{
      flex:1;
      display:flex; align-items:center; gap:10px;
      background:rgba(255,255,255,.85);
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:10px 12px;
      min-height:42px;
    }
    select{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      font-family:var(--font);
      font-size:14px;
      font-weight:900;
    }

    .btn{
      border:none;
      border-radius:16px;
      padding:11px 14px;
      min-height:42px;
      font-weight:900;
      cursor:pointer;
      background:var(--line-green);
      color:#fff;
      box-shadow:0 8px 18px rgba(6,199,85,.28);
      white-space:nowrap;
    }
    .btn:active{transform:translateY(1px)}

    .loadingRow{
      display:flex;
      align-items:center;
      gap:10px;
      padding:14px 10px 6px;
      color:#fff;
      font-weight:900;
      text-shadow:0 1px 0 rgba(0,0,0,.12);
    }
    .spinner{
      width:18px; height:18px;
      border-radius:999px;
      border:2px solid rgba(255,255,255,.65);
      border-top-color:rgba(255,255,255,.15);
      animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .list{margin-top:12px; display:grid; gap:12px}

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:26px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardInner{
      display:flex; gap:12px;
      padding:12px;
    }
    .thumb{
      width:86px; height:86px;
      border-radius:18px;
      overflow:hidden;
      background:rgba(0,0,0,.06);
      flex:0 0 auto;
    }
    .thumb img{width:100%; height:100%; object-fit:cover}
    .meta{flex:1; min-width:0}

    .row1{display:flex; justify-content:space-between; gap:10px; align-items:baseline}
    .hp{margin:0; font-weight:900; font-size:15px}
    .price{margin:0; font-weight:900; font-size:15px; white-space:nowrap}

    .subline{
      margin:4px 0 0;
      font-size:12px;
      font-weight:700;
      color:rgba(17,24,39,.55);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }

    .chips{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      background:rgba(17,24,39,.06);
      border:1px solid rgba(0,0,0,.05);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:900;
    }
    .chipGreen{background:rgba(157,229,147,.55)}

    .actions{padding:0 12px 12px}
    .aBtn{
      display:block;
      text-align:center;
      text-decoration:none;
      border-radius:18px;
      padding:11px 12px;
      font-weight:900;
      border:1px solid var(--stroke);
      background:var(--chat-green);
      color:#0b1b12;
    }

    .hint{
      margin-top:10px;
      font-size:12px;
      font-weight:800;
      color:rgba(255,255,255,.92);
      text-shadow:0 1px 0 rgba(0,0,0,.10);
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap" style="padding:0 14px;">
      <div class="titleRow">
        <div class="logoDot">SP</div>
        <div>
          <h1>smart properties system</h1>
          <div class="sub">Catalog ‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö feel LINE</div>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="row">
        <div class="selbox">
          <select id="projectSelect">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project...</option>
            <option value="Project_0">Project_0</option>
            <option value="Project_A">Project_A</option>
            <option value="Project_B">Project_B</option>
            <option value="Project_C">Project_C</option>
          </select>
        </div>
        <button class="btn" id="btnLoad">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      </div>
    </div>

    <div id="loading" class="loadingRow" style="display:none;">
      <div class="spinner"></div>
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...
    </div>

    <div id="list" class="list"></div>
    <div class="hint">Tip: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà ?project=Project_0 ‡πÑ‡∏î‡πâ</div>
  </div>

<script>
  // ‚úÖ API URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏™‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß)
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  const $ = (id)=>document.getElementById(id);

  function formatPriceTHB(n){
    const raw = String(n ?? "").trim();
    const num = Number(raw.replace(/,/g,""));
    if(!raw) return "-";
    if(!isFinite(num)) return raw;
    return "‡∏ø" + num.toLocaleString("en-US");
  }

  async function fetchUnitList(project){
    const url = `${API_URL}?mode=getUnitList&project=${encodeURIComponent(project)}&t=${Date.now()}`;
    const res = await fetch(url, { cache:"no-store" });
    const data = await res.json();
    if(data && data.error) throw new Error(data.error);
    return Array.isArray(data)?data:[];
  }

  function card(item, project){
    const detailsUrl = `details.html?id=${encodeURIComponent(item.id)}&project=${encodeURIComponent(project)}`;
    const nameLine = (item.projectName && String(item.projectName).trim()) ? item.projectName : project;

    return `
      <div class="card">
        <div class="cardInner">
          <div class="thumb">${item.thumbnail?`<img src="${item.thumbnail}" alt="">`:""}</div>
          <div class="meta">
            <div class="row1">
              <p class="hp">${item.id||"-"} ‚Ä¢ ${item.plot||"-"}</p>
              <p class="price">${formatPriceTHB(item.price)}</p>
            </div>
            <div class="subline">${nameLine}</div>
            <div class="chips">
              ${item.badge?`<div class="chip chipGreen">Badge: ${item.badge}</div>`:""}
              ${item.status?`<div class="chip">Status: ${item.status}</div>`:""}
              <div class="chip">üõè ${item.bedrooms||"-"} ‚Ä¢ üõÅ ${item.bathrooms||"-"}</div>
              <div class="chip">üìê ${item.landSqw||"-"} sq.w</div>
              <div class="chip">üè† ${item.livingSqm||"-"} sqm</div>
            </div>
          </div>
        </div>
        <div class="actions">
          <a class="aBtn" href="${detailsUrl}">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
        </div>
      </div>
    `;
  }

  async function loadList(){
    const project = $("projectSelect").value;
    if(!project){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project"); return; }

    $("list").innerHTML="";
    $("loading").style.display="flex";

    try{
      const items = await fetchUnitList(project);
      items.sort((a,b)=>String(a.id||"").localeCompare(String(b.id||"")));
      $("list").innerHTML = items.map(x=>card(x,project)).join("") || `<div class="panel" style="margin-top:12px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;
    }catch(err){
      $("list").innerHTML = `<div class="panel" style="margin-top:12px;"><b>Error:</b> ${err.message}</div>`;
    }finally{
      $("loading").style.display="none";
    }
  }

  $("btnLoad").addEventListener("click", loadList);

  // auto load if query has project
  const sp = new URLSearchParams(location.search);
  const qp = sp.get("project");
  if(qp){
    $("projectSelect").value = qp;
    loadList();
  }
</script>
</body>
</html>
