<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Properties System</title>
  <style>
    :root{ --bg:#9eb5cf; --card:#ffffff; --text:#0b1320; --radius:22px; --shadow:0 12px 30px rgba(0,0,0,.12); }
    body{ margin:0; font-family: system-ui, sans-serif; background: linear-gradient(180deg, #8faac8, #a7bdd5); color:var(--text); min-height:100vh; }
    .wrap{ max-width:1000px; margin:0 auto; padding:12px; }
    .topbar{ background: rgba(255,255,255,.2); border-radius: 26px; padding: 10px; display:flex; align-items:center; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,.4); }
    .logo{ width:38px; height:38px; border-radius:999px; background: rgba(255,255,255,.5); display:grid; place-items:center; font-weight:900; }
    .titlebox{ flex:1; padding-left:12px; }
    .title{ font-size:16px; font-weight:900; margin:0; }
    .controls{ margin-top:10px; display:flex; gap:8px; }
    .select{ flex:1; padding:10px; border-radius:16px; border:1px solid rgba(255,255,255,.5); background:rgba(255,255,255,.4); font-weight:700; }
    .grid{ margin-top:12px; display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .card{ background: white; border-radius: var(--radius); overflow:hidden; box-shadow: var(--shadow); }
    .cover{ position:relative; aspect-ratio:16/10; background:#eee; }
    .cover img{ width:100%; height:100%; object-fit:cover; }
    .badgeStatus{ position:absolute; top:10px; right:10px; padding:6px 12px; border-radius:999px; font-size:12px; font-weight:900; background:rgba(255,255,255,.9); }
    .body{ padding:12px; }
    .price{ font-size:18px; font-weight:1000; color:#0b1320; }
    .plot{ font-size:14px; font-weight:700; color:#6b7a90; }
    .btn{ width:100%; padding:12px; margin-top:10px; border:none; border-radius:12px; background:#c6f0d8; font-weight:900; cursor:pointer; }
    .loader{ position:fixed; inset:0; background:white; z-index:99; display:flex; align-items:center; justify-content:center; font-weight:900; }
    .loader.hide{ display:none; }
  </style>
</head>
<body>
  <div class="loader" id="loader">Syncing database...</div>
  <div class="wrap">
    <div class="topbar">
      <div class="logo">HP</div>
      <div class="titlebox"><p class="title" id="projName">Master Vill</p><small id="countChip">0 items</small></div>
      <a href="gateway.html" style="text-decoration:none; font-size:20px;">ðŸ‘¤</a>
    </div>
    <div class="controls">
      <select class="select" id="plotSelect"><option value="__all__">Select Plot</option></select>
      <select class="select" id="sortSelect">
        <option value="price_desc">Price High-Low</option>
        <option value="price_asc">Price Low-High</option>
      </select>
    </div>
    <div id="grid" class="grid"></div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyNPiuM1Rz70r6E38eRLQoQXIrNUTKsQsqVRLU2tOmwO9K9HfBBnO-7-I9fn6UlTZWk/exec";
    const PROJECT = "HP00";
    let allData = [];

    async function load() {
      try {
        // âœ… à¹€à¸£à¸µà¸¢à¸à¹à¸šà¸š Public (à¹„à¸¡à¹ˆà¸¡à¸µ Token) à¸à¸£à¸µà¹Šà¸”à¸ˆà¸°à¸à¸£à¸­à¸‡ Offline à¸­à¸­à¸à¹ƒà¸«à¹‰à¸ˆà¸²à¸à¸à¸±à¹ˆà¸‡ Server
        const res = await fetch(`${API_URL}?mode=getUnitList&project=${PROJECT}`);
        const data = await res.json();
        allData = data;
        
        document.getElementById("projName").textContent = data[0]?.projectName || "Master Vill";
        render();
        buildPlots();
        document.getElementById("loader").classList.add("hide");
      } catch(e) { alert("Load Failed"); }
    }

    function buildPlots() {
      const plots = [...new Set(allData.map(x => x.plot))].sort();
      const sel = document.getElementById("plotSelect");
      plots.forEach(p => { if(p) sel.innerHTML += `<option value="${p}">${p}</option>`; });
    }

    function render() {
      const grid = document.getElementById("grid");
      const plotVal = document.getElementById("plotSelect").value;
      const sortVal = document.getElementById("sortSelect").value;
      
      let filtered = allData.filter(x => plotVal === "__all__" || x.plot === plotVal);
      filtered.sort((a,b) => {
        const pa = Number(String(a.price).replace(/,/g,''));
        const pb = Number(String(b.price).replace(/,/g,''));
        return sortVal === "price_asc" ? pa - pb : pb - pa;
      });

      document.getElementById("countChip").textContent = `${filtered.length} items`;
      grid.innerHTML = filtered.map(item => `
        <div class="card">
          <div class="cover">
            <img src="${item.thumbnail || ''}" alt="img">
            <div class="badgeStatus">${item.status}</div>
          </div>
          <div class="body">
            <div class="plot">PLOT: ${item.plot}</div>
            <div class="price">à¸¿${Number(item.price).toLocaleString()}</div>
            <button class="btn" onclick="location.href='details.html?id=${item.id}'">More Details</button>
          </div>
        </div>
      `).join("");
    }

    document.getElementById("plotSelect").onchange = render;
    document.getElementById("sortSelect").onchange = render;
    window.onload = load;
  </script>
</body>
</html>
