<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DIRECT HUB - PROPERTIES</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    body{font-family:'Kanit',sans-serif;background:#f3f5f8}
    .card-shadow{box-shadow:0 20px 40px rgba(15,23,42,.10)}
    .glass{background:rgba(255,255,255,.75);backdrop-filter: blur(10px)}
    .pill{border-radius:999px}
  </style>
</head>

<body class="min-h-screen">
  <!-- Header (‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å) -->
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-3">
    <div class="flex items-start justify-between">
      <div>
        <h1 class="text-4xl font-extrabold italic tracking-tight text-slate-900">DIRECT HUB</h1>
        <p class="text-lg font-bold italic text-blue-700 mt-1">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</p>
      </div>
      <button id="profileBtn" class="w-12 h-12 rounded-2xl bg-white card-shadow flex items-center justify-center text-2xl" title="Profile">
        üë§
      </button>
    </div>
  </header>

  <!-- List -->
  <main class="max-w-6xl mx-auto px-4 pb-10">
    <div id="list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <div id="loading" class="text-center py-10 text-slate-500 font-bold">Loading...</div>
    <div id="error" class="hidden text-center py-10 text-red-600 font-bold"></div>
  </main>

<script>
  // ‚úÖ ‡πÉ‡∏™‡πà API ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  // ‚úÖ ‡πÉ‡∏ä‡πâ project ‡∏à‡∏≤‡∏Å URL ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°: dashboard.html?project=Project_0
  const urlParams = new URLSearchParams(location.search);
  const PROJECT = urlParams.get("project") || "Project_0";

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢ + ‡∏™‡∏µ
  function statusMeta(raw){
    const s = String(raw || "").trim();

    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°/‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
    const map = {
      "Available": {th:"‡∏ß‡πà‡∏≤‡∏á", cls:"bg-emerald-100 text-emerald-700"},
      "Under Con": {th:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á", cls:"bg-sky-100 text-sky-700"},
      "Under Construction": {th:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á", cls:"bg-sky-100 text-sky-700"},
      "Reserved": {th:"‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß", cls:"bg-amber-100 text-amber-700"},
      "Sold": {th:"‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß", cls:"bg-rose-100 text-rose-700"},
      "": {th:"-", cls:"bg-slate-100 text-slate-600"}
    };

    return map[s] || {th:s, cls:"bg-slate-100 text-slate-700"};
  }

  function fmtPrice(n){
    const x = Number(String(n || "").replace(/,/g,""));
    if (Number.isFinite(x)) return x.toLocaleString("en-US");
    return String(n || "-");
  }

  // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ details
  function detailsLink(id){
    // ‡∏õ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    return `details.html?id=${encodeURIComponent(id)}&project=${encodeURIComponent(PROJECT)}`;
  }

  function cardTemplate(item){
    const id = item.id || "";
    const plot = String(item.plot || "").trim();     // ‚úÖ ‡πÉ‡∏ä‡πâ plot ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Z-3 (‡∏Ç‡πâ‡∏≠ 1)
    const thumb = item.thumbnail || "";
    const status = statusMeta(item.unitStatus);

    // ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: info line ‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ (Bed/Bath/Land/Living + Status)
    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å API. ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
    // ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Apps Script mode=getUnitList ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á bedrooms/bathrooms/land_sqw/living_sqm ‡πÑ‡∏î‡πâ
    const bedrooms = item.bedrooms ?? item.Bedrooms ?? "";
    const bathrooms = item.bathrooms ?? item.Bathrooms ?? "";
    const landSqw = item.landSqw ?? item.Land_Area_sqw ?? "";
    const livingSqm = item.livingSqm ?? item.Living_Area_sqm ?? "";

    // ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 4: ‡∏£‡∏≤‡∏Ñ‡∏≤
    const price = fmtPrice(item.price ?? item.Price);

    return `
      <article class="rounded-[2.5rem] bg-white card-shadow overflow-hidden">
        <div class="relative">
          <div class="aspect-[4/3] bg-slate-100 overflow-hidden">
            ${thumb
              ? `<img src="${thumb}" class="w-full h-full object-cover" alt="${id}">`
              : `<div class="w-full h-full flex items-center justify-center text-5xl text-slate-300">üñºÔ∏è</div>`
            }
          </div>

          <!-- ‚úÖ (1) ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Z-3 ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ Plot -->
          <div class="absolute top-4 left-4 glass pill px-4 py-2 font-extrabold italic text-slate-900">
            ${plot ? plot : "-"}
          </div>

          <!-- ‚úÖ (3) ‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡πÑ‡∏°‡πà‡∏°‡∏µ element ‡∏ô‡∏µ‡πâ) -->
        </div>

        <div class="p-5">
          <!-- ‚úÖ (2) ‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î -->
          <div class="flex flex-wrap items-center gap-2 text-sm font-bold text-slate-700">
            <span class="px-3 py-1 rounded-xl bg-slate-100">üõè ${bedrooms || "-"}</span>
            <span class="px-3 py-1 rounded-xl bg-slate-100">üõÅ ${bathrooms || "-"}</span>
            <span class="px-3 py-1 rounded-xl bg-slate-100">üìê ${landSqw || "-"} sq.w</span>
            <span class="px-3 py-1 rounded-xl bg-slate-100">üè† ${livingSqm || "-"} sqm</span>

            <span class="ml-auto px-3 py-1 rounded-xl ${status.cls}">
              ${status.th}
            </span>
          </div>

          <!-- ‚úÖ (4) ‡∏£‡∏≤‡∏Ñ‡∏≤ -->
          <div class="mt-4 text-3xl font-extrabold italic text-slate-900">
            ‡∏ø ${price}
          </div>
          <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">
            Unit: ${id}
          </div>

          <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ details -->
          <a href="${detailsLink(id)}"
             class="mt-5 block w-full text-center py-4 rounded-[2rem] bg-slate-900 text-white font-extrabold italic tracking-widest hover:bg-blue-600 transition-all active:scale-95">
            VIEW FULL DETAILS
          </a>
        </div>
      </article>
    `;
  }

  async function loadList(){
    const listEl = document.getElementById("list");
    const loadingEl = document.getElementById("loading");
    const errorEl = document.getElementById("error");

    try{
      loadingEl.classList.remove("hidden");
      errorEl.classList.add("hidden");

      const res = await fetch(`${API_URL}?mode=getUnitList&project=${encodeURIComponent(PROJECT)}&t=${Date.now()}`);
      const data = await res.json();
      if(data && data.error) throw new Error(data.error);
      if(!Array.isArray(data)) throw new Error("Invalid list response");

      // Render
      listEl.innerHTML = data.map(cardTemplate).join("");

      loadingEl.classList.add("hidden");
    }catch(err){
      loadingEl.classList.add("hidden");
      errorEl.classList.remove("hidden");
      errorEl.textContent = "Load failed: " + err.message;
    }
  }

  window.onload = loadList;
</script>
</body>
</html>
