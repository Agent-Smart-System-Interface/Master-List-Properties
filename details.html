<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>smart properties system ¬∑ details</title>

  <link rel="preconnect" href="https://script.google.com">
  <link rel="preconnect" href="https://lh3.googleusercontent.com">

  <style>
    :root{
      --bg:#a8bdd6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7c93;
      --radius:22px;
      --shadow: 0 12px 30px rgba(0,0,0,.12);
      --soft:#f3f6fb;
      --line:rgba(255,255,255,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Thai", sans-serif;
      background: radial-gradient(ellipse at top, rgba(255,255,255,.25), rgba(255,255,255,0) 55%) , var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px 14px 30px;}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
      border: 1px solid var(--line);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:44px; height:44px; border-radius:999px; background:rgba(255,255,255,.55);
      display:grid; place-items:center; font-weight:800;
      flex:0 0 auto;
    }
    .titles{min-width:0}
    .titles h1{
      margin:0;
      font-size:20px;
      line-height:1.15;
      font-weight:1100;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      letter-spacing:.2px;
    }
    .titles .sub{display:none;}
    .backBtn{
      width:44px; height:44px; border-radius:999px;
      border:0; background: rgba(255,255,255,.55);
      cursor:pointer; font-size:18px; font-weight:900;
      flex:0 0 auto;
    }

    .card{
      margin-top:14px;
      background: rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.65);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Gallery */
    .gallery{
      position:relative;
      background:#dfe9f6;
    }
    .mainSlide{
      width:100%;
      aspect-ratio: 16/10;
      object-fit:cover;
      display:block;
    }

    .tagTopLeft{
      position:absolute;
      padding:8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.78);
      font-weight:1100;
      font-size:14px;
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.65);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 78%;
      left:14px; top:14px;
    }

    .tagBottomRight{
      position:absolute;
      right:14px;
      bottom:14px;
      padding:0;
      border-radius:0;
      background: transparent;
      box-shadow:none;
      backdrop-filter:none;
      border:0;
      font-weight:1100;
      font-size:14px;
      color: rgba(255,255,255,.98);
      text-shadow: 0 10px 18px rgba(0,0,0,.45);
      user-select:none;
      pointer-events:none;
    }

    .thumbStrip{
      background: rgba(255,255,255,.78);
      padding:10px;
      display:flex;
      gap:10px;
      overflow:auto;
      scroll-snap-type: x mandatory;
    }
    .thumb{
      width:92px; height:64px;
      flex:0 0 auto;
      border-radius: 16px;
      object-fit:cover;
      border:3px solid transparent;
      cursor:pointer;
      scroll-snap-align: start;
      background:#e8f0fb;
    }
    .thumb.active{border-color:#0f172a;}

    .content{padding:14px;}

    .headRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:nowrap;
    }
    .hp{display:none;}

    .price{
      font-size:28px;
      font-weight:1100;
      letter-spacing:.2px;
      white-space:nowrap;
      flex:1 1 auto;
      min-width:0;
    }

    .statusBelow{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 12px;
      border-radius: 12px;
      font-weight:1100;
      font-size:16px;
      line-height:1;
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(16,185,129,.55);
      color: rgba(5,150,105,1);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
      white-space:nowrap;
      flex:0 0 auto;
    }

    @media (max-width:420px){
      .price{font-size:24px}
      .statusBelow{font-size:14px; padding:7px 10px;}
      .tagTopLeft{font-size:13px; padding:7px 10px;}
    }

    .gridInfo{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media(min-width:900px){
      .gridInfo{grid-template-columns: repeat(3, 1fr);}
    }
    .infoBox{
      background: rgba(15,23,42,.05);
      border:1px solid rgba(15,23,42,.06);
      border-radius: 18px;
      padding:12px 12px;
      display:flex; justify-content:space-between; gap:10px;
      font-weight:1100;
    }
    .k{color:rgba(15,23,42,.55); font-weight:900;}
    .v{color:rgba(15,23,42,.95); font-weight:1100; text-align:right; white-space:pre-wrap;}

    .infoBox.double{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:start;
    }
    .infoPair{
      display:flex;
      justify-content:space-between;
      gap:10px;
      min-width:0;
    }
    .infoPair .k{white-space:nowrap;}
    .infoPair .v{
      text-align:right;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
    }

    .errorBox{
      margin-top:14px;
      padding:14px;
      border-radius: 18px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(255,255,255,.65);
      font-weight:1100;
      color:#8b1d1d;
      display:none;
    }
    .skeleton{
      background: linear-gradient(90deg, rgba(255,255,255,.55), rgba(255,255,255,.25), rgba(255,255,255,.55));
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite linear;
    }
    @keyframes shimmer{
      0%{background-position: 200% 0;}
      100%{background-position: -200% 0;}
    }

    .pageLoader{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(ellipse at top, rgba(255,255,255,.25), rgba(255,255,255,0) 55%) , var(--bg);
      z-index:99999;
    }
    .loaderPanel{
      text-align:center;
      padding:18px 22px;
      border-radius: 26px;
      background: rgba(255,255,255,.18);
      border: 1px solid var(--line);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,.16);
      max-width: 92vw;
    }
    .loaderEmojis{
      display:flex;
      gap:18px;
      justify-content:center;
      align-items:center;
      font-size:52px;
      line-height:1;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.18));
    }
    .loaderEmojis span{
      display:inline-block;
      animation: bounce 0.9s ease-in-out infinite;
    }
    .loaderEmojis span:nth-child(2){ animation-delay: .12s; }
    .loaderEmojis span:nth-child(3){ animation-delay: .24s; }
    @keyframes bounce{
      0%,100%{ transform: translateY(0); opacity:.95; }
      50%{ transform: translateY(-12px); opacity:1; }
    }
    .loaderText{
      margin-top:12px;
      font-weight:1100;
      letter-spacing:.6px;
      color: rgba(15,23,42,.92);
      text-shadow: 0 10px 22px rgba(0,0,0,.10);
      font-size:22px;
      white-space:nowrap;
    }
    @media (max-width:420px){
      .loaderEmojis{font-size:44px}
      .loaderText{font-size:18px}
    }

    .navArrow{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width:54px;
      height:54px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.55);
      background: rgba(255,255,255,.22);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      z-index:5;
    }
    .navArrow:active{ transform: translateY(-50%) scale(.98); }
    .navArrow svg{
      width:24px;height:24px;
      stroke: rgba(255,255,255,.95);
      opacity:.95;
    }
    .navLeft{ left:14px; }
    .navRight{ right:14px; }
    @media (max-width:420px){
      .navArrow{ width:48px;height:48px; }
      .navArrow svg{ width:22px;height:22px; }
    }

    .otherSection{
      margin-top:14px;
      padding:14px;
      border-radius: 18px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.65);
    }
    .otherTitle{
      font-weight:1100;
      letter-spacing:.3px;
      color: rgba(15,23,42,.88);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .otherHint{
      font-weight:900;
      color: rgba(15,23,42,.55);
      font-size:12px;
      white-space:nowrap;
    }
    .otherGrid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
    }
    .otherCard{
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.06);
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
      overflow:hidden;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease;
    }
    .otherCard:active{ transform: scale(.985); }
    .otherImg{
      width:100%;
      aspect-ratio: 16/10;
      object-fit:cover;
      display:block;
      background:#e8f0fb;
    }
    .otherBody{
      padding:10px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .otherTopRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .otherPlot{
      font-weight:1100;
      font-size:13px;
      color: rgba(15,23,42,.95);
      white-space:normal;
      overflow:visible;
      text-overflow:clip;
      flex:1 1 auto;
      min-width:0;
    }
    .otherStatus{
      padding:5px 8px;
      border-radius: 999px;
      font-weight:1100;
      font-size:11px;
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(15,23,42,.15);
      color: rgba(15,23,42,.88);
      white-space:nowrap;
      flex:0 0 auto;
    }
    .otherPrice{
      font-weight:1100;
      font-size:16px;
      color: rgba(15,23,42,.92);
      white-space:nowrap;
    }

    .otherId{
      font-weight:600;
      font-size:11px;
      letter-spacing:-0.2px;
      color: rgba(15,23,42,.55);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:clip;
    }

    @media (max-width:360px){
      .otherGrid{ grid-template-columns: 1fr; }
    }

    .shareSection{
      margin-top:14px;
      padding:14px;
      border-radius: 18px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.65);
    }
    .shareTopIcon{
      display:flex;
      justify-content:center;
      align-items:center;
      padding:8px 0 10px;
      opacity:.85;
    }
    .shareRow{
      display:flex;
      gap:14px;
      justify-content:center;
      overflow:auto;
      padding:10px 8px 6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .shareBtn{
      flex:0 0 auto;
      width:58px;
      scroll-snap-align:center;
      border:0;
      background:transparent;
      cursor:pointer;
      text-align:center;
      user-select:none;
    }
    .shareCircle{
      width:52px; height:52px;
      border-radius:999px;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(15,23,42,.08);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      display:grid;
      place-items:center;
      margin:0 auto;
    }
    .shareLbl{
      margin-top:6px;
      font-size:11px;
      font-weight:900;
      color: rgba(15,23,42,.65);
      white-space:nowrap;
    }
    .shareBtn:active .shareCircle{ transform: scale(.97); }
    #shareCanvas{ display:none; }
  </style>
</head>
<body>

  <div class="pageLoader" id="pageLoader" aria-label="loading">
    <div class="loaderPanel">
      <div class="loaderEmojis" aria-hidden="true">
        <span>üè†</span><span>‚ú®</span><span>üå¥</span>
      </div>
      <div class="loaderText">Smart Properties System</div>
    </div>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">SP</div>
        <div class="titles">
          <h1 id="pageTitle">Detail Plot: -</h1>
          <div class="sub" id="subTitle">Details ¬∑ ...</div>
        </div>
      </div>
      <button class="backBtn" id="btnBack">‚Üê</button>
    </div>

    <div class="errorBox" id="errBox"></div>

    <div class="card" id="mainCard">
      <div class="gallery" id="gallery">
        <img class="mainSlide skeleton" id="mainImg" alt="main" />
        <div class="tagTopLeft" id="tagPlot">-</div>
        <div class="tagBottomRight" id="tagCount">0 / 0</div>

        <div class="navArrow navLeft" id="btnPrev" aria-label="previous">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"></path>
          </svg>
        </div>
        <div class="navArrow navRight" id="btnNext" aria-label="next">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 6l6 6-6 6"></path>
          </svg>
        </div>
      </div>

      <div class="thumbStrip" id="thumbStrip"></div>

      <div class="content">
        <div class="headRow">
          <div class="hp" id="hpText">...</div>
          <div class="price" id="priceText">‡∏ø0</div>
          <div class="statusBelow" id="statusBelow">-</div>
        </div>

        <div class="gridInfo" id="infoGrid"></div>

        <div class="shareSection" id="shareSection">
          <div class="shareTopIcon" aria-hidden="true" title="Share">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="rgba(15,23,42,.85)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="2"></circle>
              <circle cx="6" cy="12" r="2"></circle>
              <circle cx="18" cy="19" r="2"></circle>
              <path d="M8 12l8-7"></path>
              <path d="M8 12l8 7"></path>
            </svg>
          </div>

          <div class="shareRow" id="shareRow">
            <!-- (‡∏õ‡∏∏‡πà‡∏° share ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) -->
            <!-- ... ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° ... -->
          </div>

          <canvas id="shareCanvas" width="1200" height="630"></canvas>
        </div>

        <div class="otherSection" id="otherSection">
          <div class="otherTitle">
            <div>Other Plots</div>
            <div class="otherHint">Tap to view details</div>
          </div>
          <div class="otherGrid" id="otherGrid"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/** =========================
 * CONFIG
 * ========================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxvzszMpjb1Dy3nQDhh64oPYu1-CgL-RSdRe52Df_pejfqkhq-g70z96npgaSyNAw2T/exec";
const qs = new URLSearchParams(location.search);
const hpId = qs.get("id") || qs.get("hpId") || "";

/** ‚úÖ NEW: normalize project name */
function normalizeProjectName(p){
  const s = String(p || "").trim();
  const map = {
    "Project_0": "project_000",
    "Project_A": "project_001",
    "Project_B": "project_002",
    "Project_C": "project_003",
    "Project_D": "project_004",
    "project_0": "project_000",
    "project_A": "project_001",
    "project_B": "project_002",
    "project_C": "project_003",
    "project_D": "project_004",
  };
  return map[s] || s || "project_000";
}

const project = normalizeProjectName(qs.get("project"));

/** Loader helpers */
function showLoader(){
  const el = document.getElementById("pageLoader");
  if(el) el.style.display = "flex";
}
function hideLoader(){
  const el = document.getElementById("pageLoader");
  if(el) el.style.display = "none";
}

/** JSONP */
function jsonp(url, timeoutMs = 20000){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).slice(2);
    const script = document.createElement("script");
    const timer = setTimeout(() => { cleanup(); reject(new Error("timeout")); }, timeoutMs);

    function cleanup(){
      clearTimeout(timer);
      if (script.parentNode) script.parentNode.removeChild(script);
      try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
    }
    window[cb] = (data) => { cleanup(); resolve(data); };

    const sep = url.includes("?") ? "&" : "?";
    script.src = url + sep + "callback=" + encodeURIComponent(cb);
    script.onerror = () => { cleanup(); reject(new Error("jsonp_error")); };
    document.body.appendChild(script);
  });
}

function showError(msg){
  const box = document.getElementById("errBox");
  box.style.display = "block";
  box.textContent = msg;
}
function hideError(){
  const box = document.getElementById("errBox");
  box.style.display = "none";
  box.textContent = "";
}

function toNumber(x){
  const s = String(x ?? "").replace(/,/g,"").trim();
  const n = Number(s);
  return Number.isFinite(n) ? n : 0;
}
function moneyTHB(x){
  const n = toNumber(x);
  return "‡∏ø" + n.toLocaleString("en-US");
}
function cleanDriveImage(url){
  const u = String(url || "").trim();
  if(!u) return "";
  if (u.includes("lh3.googleusercontent.com/d/")) return u;

  let id = "";
  const m1 = u.match(/\/d\/([a-zA-Z0-9_-]+)/);
  if (m1) id = m1[1];
  const m2 = u.match(/[?&]id=([a-zA-Z0-9_-]+)/);
  if (!id && m2) id = m2[1];
  const m3 = u.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
  if (!id && m3) id = m3[1];

  if (id) return "https://lh3.googleusercontent.com/d/" + id;
  return u;
}

/* ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
function statusStyle(statusRaw){
  const s = String(statusRaw||"").trim().toLowerCase();
  if (s.includes("available")) return {border:"rgba(16,185,129,.65)", text:"rgba(5,150,105,1)"};
  if (s.includes("under"))     return {border:"rgba(14,165,233,.55)", text:"rgba(2,132,199,1)"};
  if (s.includes("reserved"))  return {border:"rgba(245,158,11,.55)", text:"rgba(180,83,9,1)"};
  if (s.includes("sold"))      return {border:"rgba(244,63,94,.55)",  text:"rgba(190,18,60,1)"};
  return {border:"rgba(15,23,42,.25)", text:"rgba(15,23,42,.92)"};
}

document.getElementById("btnBack").addEventListener("click", () => {
  history.length > 1 ? history.back() : (location.href = "index.html");
});

/* === ‡∏™‡πà‡∏ß‡∏ô logic ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î === */
/* (‡∏ú‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å normalize project) */

/** LOAD */
(async function init(){
  hideError();
  showLoader();

  if(!hpId){
    showError("‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÑ‡∏°‡πà‡∏°‡∏µ id ‡πÄ‡∏ä‡πà‡∏ô details.html?id=HP-Z001");
    hideLoader();
    return;
  }

  const url = `${SCRIPT_URL}?mode=getUnitDetail&project=${encodeURIComponent(project)}&hpId=${encodeURIComponent(hpId)}`;

  let detail;
  try{
    detail = await jsonp(url);
  }catch(err){
    showError("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏£‡∏ß‡∏à Deploy Apps Script ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Anyone ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ /exec)");
    hideLoader();
    return;
  }

  if(detail && detail.error){
    showError("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + detail.error);
    hideLoader();
    return;
  }

  /* === ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° === */
  // ... (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ...
  hideLoader();
})();
</script>
</body>
</html>
