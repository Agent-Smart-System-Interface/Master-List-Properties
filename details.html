<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>UNIT DETAILS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --line-green:#06C755;
      --line-bg:#EEF1F6;
      --line-card:#FFFFFF;
      --line-ink:#0f172a;
      --line-muted:#64748b;
      --line-border: rgba(15,23,42,.10);
      --shadow: 0 12px 30px rgba(2,6,23,.10);
      --r: 26px;
    }
    body{font-family:'Kanit',sans-serif;background:var(--line-bg);color:var(--line-ink)}
    .card{background:var(--line-card);border:1px solid var(--line-border);border-radius:var(--r);box-shadow:var(--shadow)}
    .pill{border-radius:999px;padding:10px 14px;font-weight:800;display:inline-flex;gap:8px;align-items:center}
    .muted{color:var(--line-muted)}
    .title{font-weight:900;letter-spacing:-.02em}
    .heroWrap{position:relative;border-radius:var(--r);overflow:hidden;background:#e9edf4}
    .heroImg{width:100%;height:clamp(260px,50vw,520px);object-fit:cover;display:block;user-select:none;-webkit-user-drag:none}
    /* ‚úÖ arrows: no white background */
    .navArrow{
      position:absolute;top:50%;transform:translateY(-50%);
      width:52px;height:52px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      color:rgba(255,255,255,.85);
      background:transparent;          /* ‚úÖ no bg */
      border:none;
      cursor:pointer;
      text-shadow: 0 6px 18px rgba(0,0,0,.50);
      -webkit-tap-highlight-color: transparent;
    }
    .navArrow:active{ transform:translateY(-50%) scale(.96); }
    .navArrow svg{ width:28px;height:28px; filter: drop-shadow(0 6px 14px rgba(0,0,0,.35)); }
    .navLeft{left:14px}
    .navRight{right:14px}

    .thumbRow{display:flex;gap:10px;overflow:auto;padding:12px}
    .thumbRow::-webkit-scrollbar{height:10px}
    .thumbRow::-webkit-scrollbar-thumb{background:rgba(15,23,42,.18);border-radius:999px}
    .thumb{
      width:92px;height:72px;flex:0 0 auto;
      border-radius:18px;overflow:hidden;
      border:2px solid transparent;
      background:#e9edf4;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .thumb.active{border-color: var(--line-green)}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}

    /* ‚úÖ loading overlay */
    .pageLoading{
      position:fixed;inset:0;
      background:rgba(238,241,246,.92);
      display:flex;align-items:center;justify-content:center;
      z-index:99;
    }
    .loaderCard{
      width:min(520px,92vw);
      background:#fff;border:1px solid var(--line-border);
      border-radius:22px;
      box-shadow:var(--shadow);
      padding:18px;
    }
    .shimmer{
      background:linear-gradient(90deg,#e9edf4 25%,#f8fafc 37%,#e9edf4 63%);
      background-size:400% 100%;
      animation:shimmer 1.2s ease infinite;
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
    .s1{height:18px;border-radius:12px}
    .s2{height:12px;border-radius:12px}
    .sHero{height:260px;border-radius:22px}

    /* prevent any image click opening new page */
    #heroImg{ pointer-events:none; }
  </style>
</head>
<body>
  <!-- ‚úÖ Loading overlay (‡∏ï‡∏≠‡∏ô‡∏ä‡πâ‡∏≤ ‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏î‡∏π‡∏û‡∏±‡∏á) -->
  <div id="pageLoading" class="pageLoading">
    <div class="loaderCard">
      <div class="flex items-center justify-between mb-3">
        <div class="font-extrabold text-slate-900">Loading unit details‚Ä¶</div>
        <div class="text-sm muted font-semibold">Please wait</div>
      </div>
      <div class="s1 shimmer w-2/3 mb-2"></div>
      <div class="s2 shimmer w-1/2 mb-4"></div>
      <div class="sHero shimmer w-full mb-4"></div>
      <div class="s1 shimmer w-1/3 mb-2"></div>
      <div class="s2 shimmer w-2/3"></div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 py-6">
    <!-- Top bar -->
    <div class="flex items-start justify-between gap-3 mb-4">
      <div>
        <div class="text-3xl md:text-5xl title italic">UNIT <span id="unitTitle">-</span></div>
        <div class="mt-1 muted font-semibold">Project: <span id="projectName">-</span> ‚Ä¢ Unit: <span id="unitId">-</span></div>
      </div>
      <div class="flex gap-2">
        <button id="btnBack" class="card px-4 py-3 font-extrabold rounded-2xl">‚Üê</button>
        <button id="btnHome" class="card px-4 py-3 font-extrabold rounded-2xl">‚åÇ</button>
      </div>
    </div>

    <!-- Hero -->
    <div class="card p-4 md:p-5 mb-6">
      <div class="mb-3 font-extrabold text-slate-900">Property photo</div>

      <div class="heroWrap">
        <img id="heroImg" class="heroImg" alt="property photo" src="" />
        <!-- arrows -->
        <button id="prevBtn" class="navArrow navLeft" aria-label="previous photo">
          <svg viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button id="nextBtn" class="navArrow navRight" aria-label="next photo">
          <svg viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>

        <div id="countPill" class="pill" style="position:absolute;right:14px;bottom:14px;background:rgba(255,255,255,.90);">
          <span id="countText" class="font-extrabold">1 / 1</span>
        </div>

        <div id="plotPill" class="pill" style="position:absolute;left:14px;top:14px;background:rgba(255,255,255,.90);">
          <span id="plotText" class="font-extrabold">-</span>
        </div>

        <div id="statusPill" class="pill" style="position:absolute;right:14px;top:14px;background:rgba(220,252,231,.92);color:#047857;">
          <span id="statusText" class="font-extrabold">-</span>
        </div>
      </div>

      <!-- thumbs -->
      <div id="thumbRow" class="thumbRow"></div>
    </div>

    <!-- Info cards -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">
      <div class="card p-5 lg:col-span-2">
        <div class="flex flex-wrap gap-2 mb-4">
          <div id="badgePill" class="pill" style="background:rgba(99,102,241,.10);color:#4f46e5;">Badge: -</div>
          <div id="sysPill" class="pill" style="background:rgba(15,23,42,.06);color:#0f172a;">System: -</div>
          <div class="ml-auto muted font-semibold" id="updatedText">Updated: -</div>
        </div>

        <div class="text-4xl md:text-5xl font-black tracking-tight" id="priceText">‡∏ø0</div>
        <div class="muted font-semibold mt-1">PRICE</div>

        <div class="mt-5 grid grid-cols-2 md:grid-cols-4 gap-2">
          <div class="pill" style="background:rgba(15,23,42,.06);">üõè <span id="bedText">-</span></div>
          <div class="pill" style="background:rgba(15,23,42,.06);">üõÅ <span id="bathText">-</span></div>
          <div class="pill" style="background:rgba(15,23,42,.06);">üìê <span id="landText">-</span> sq.w</div>
          <div class="pill" style="background:rgba(15,23,42,.06);">üè† <span id="livingText">-</span> sqm</div>
        </div>

        <div class="mt-6">
          <div class="font-extrabold text-slate-900 mb-2">Description</div>
          <div id="descText" class="muted font-medium leading-relaxed">-</div>
        </div>
      </div>

      <div class="card p-5">
        <div class="font-extrabold text-slate-900 mb-2">Links</div>
        <a id="mapLink" class="block pill mb-2" style="background:rgba(6,199,85,.10);color:#047857;" target="_blank" rel="noopener">üìç Google Map</a>
        <a id="fbLink" class="block pill mb-2" style="background:rgba(59,130,246,.10);color:#1d4ed8;" target="_blank" rel="noopener">üìò Facebook</a>
        <a id="vtLink" class="block pill" style="background:rgba(245,158,11,.10);color:#b45309;" target="_blank" rel="noopener">üé• Virtual Tour</a>
      </div>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

const qs = new URLSearchParams(location.search);
const hpId = qs.get("id") || qs.get("hpId") || "";
const project = qs.get("project") || "Project_0";

const elLoading = document.getElementById("pageLoading");

const elUnitTitle = document.getElementById("unitTitle");
const elProjectName = document.getElementById("projectName");
const elUnitId = document.getElementById("unitId");

const elHero = document.getElementById("heroImg");
const elThumbRow = document.getElementById("thumbRow");

const elPlot = document.getElementById("plotText");
const elStatus = document.getElementById("statusText");

const elCount = document.getElementById("countText");
const elPrev = document.getElementById("prevBtn");
const elNext = document.getElementById("nextBtn");

const elBadge = document.getElementById("badgePill");
const elSys = document.getElementById("sysPill");
const elUpdated = document.getElementById("updatedText");

const elPrice = document.getElementById("priceText");
const elBed = document.getElementById("bedText");
const elBath = document.getElementById("bathText");
const elLand = document.getElementById("landText");
const elLiving = document.getElementById("livingText");
const elDesc = document.getElementById("descText");

const elMap = document.getElementById("mapLink");
const elFB  = document.getElementById("fbLink");
const elVT  = document.getElementById("vtLink");

const btnBack = document.getElementById("btnBack");
const btnHome = document.getElementById("btnHome");

let GALLERY = [];
let idx = 0;

function priceFmt(v){
  const n = Number(v);
  return (!n || n===0) ? "‡∏ø0" : "‡∏ø" + n.toLocaleString();
}

function safeStr(v){
  const s = String(v ?? "").trim();
  return s ? s : "-";
}

function setStatusPill(status){
  const s = String(status||"").toLowerCase();
  const pill = document.getElementById("statusPill");
  if (s.includes("available")){
    pill.style.background = "rgba(220,252,231,.92)";
    pill.style.color = "#047857";
  }else if (s.includes("sold")){
    pill.style.background = "rgba(254,226,226,.92)";
    pill.style.color = "#b91c1c";
  }else if (s.includes("pending") || s.includes("under")){
    pill.style.background = "rgba(224,242,254,.92)";
    pill.style.color = "#0369a1";
  }else{
    pill.style.background = "rgba(15,23,42,.06)";
    pill.style.color = "#0f172a";
  }
}

function setHero(i){
  if (!GALLERY.length){
    elHero.src = "";
    elCount.textContent = "1 / 1";
    return;
  }
  idx = (i + GALLERY.length) % GALLERY.length;
  elHero.src = GALLERY[idx];
  elCount.textContent = `${idx+1} / ${GALLERY.length}`;
  // thumbs active
  [...elThumbRow.querySelectorAll(".thumb")].forEach((t,ti)=>{
    t.classList.toggle("active", ti===idx);
  });
}

function buildThumbs(){
  elThumbRow.innerHTML = GALLERY.map((u,i)=>`
    <div class="thumb ${i===0?"active":""}" data-i="${i}">
      <img src="${u}" alt="thumb" loading="lazy" decoding="async">
    </div>
  `).join("");
  elThumbRow.addEventListener("click", (e)=>{
    const t = e.target.closest(".thumb");
    if(!t) return;
    setHero(Number(t.getAttribute("data-i")));
  });
}

async function load(){
  try{
    if(!hpId){
      throw new Error("Missing id");
    }
    const url = `${API_URL}?mode=getUnitDetail&project=${encodeURIComponent(project)}&hpId=${encodeURIComponent(hpId)}&t=${Date.now()}`;
    const res = await fetch(url);
    const d = await res.json();
    if(d && d.error) throw new Error(d.error);

    // header
    elUnitTitle.textContent = safeStr(d.Plot);
    elProjectName.textContent = safeStr(project);
    elUnitId.textContent = safeStr(d.HP_ID || hpId);

    // pills
    elPlot.textContent = safeStr(d.Plot);
    elStatus.textContent = safeStr(d.Status);
    setStatusPill(d.Status);

    elBadge.textContent = `Badge: ${safeStr(d.Badge)}`;
    elSys.textContent = `System: ${safeStr(d.System_Status)}`;
    elUpdated.textContent = `Updated: ${safeStr(d.Last_Updated)}`;

    // price + features
    elPrice.textContent = priceFmt(d.Price);
    elBed.textContent = safeStr(d.Bedrooms);
    elBath.textContent = safeStr(d.Bathrooms);
    elLand.textContent = safeStr(d.Land_Area_sq_w);
    elLiving.textContent = safeStr(d.Living_Area_sq_m);

    elDesc.textContent = String(d.Description ?? "").trim() || "-";

    // links
    const map = String(d.Map_Link || "").trim();
    const fb  = String(d.FBLink || "").trim();
    const vt  = String(d.Virtual_Tour || "").trim();
    elMap.style.display = map ? "inline-flex" : "none";
    elFB.style.display  = fb ? "inline-flex" : "none";
    elVT.style.display  = vt ? "inline-flex" : "none";
    if(map) elMap.href = map;
    if(fb)  elFB.href  = fb;
    if(vt)  elVT.href  = vt;

    // gallery
    const thumb = String(d.Thumbnail_Image || "").trim();
    const list = String(d.Image_List || "").split(",").map(s=>s.trim()).filter(Boolean);
    GALLERY = [];
    if(thumb) GALLERY.push(thumb);
    GALLERY = GALLERY.concat(list);

    // build
    buildThumbs();
    setHero(0);

  }finally{
    // hide loading (even error)
    elLoading.style.display = "none";
  }
}

elPrev.addEventListener("click", ()=>setHero(idx-1));
elNext.addEventListener("click", ()=>setHero(idx+1));

// swipe (mobile) without popup
let startX = 0;
elHero.addEventListener("touchstart", (e)=>{ startX = e.touches[0].clientX; }, {passive:true});
elHero.addEventListener("touchend", (e)=>{
  const dx = e.changedTouches[0].clientX - startX;
  if(Math.abs(dx) < 35) return;
  if(dx > 0) setHero(idx-1); else setHero(idx+1);
}, {passive:true});

// nav buttons
btnBack.addEventListener("click", ()=> history.length>1 ? history.back() : (location.href = `index.html?project=${encodeURIComponent(project)}`));
btnHome.addEventListener("click", ()=> location.href = `index.html?project=${encodeURIComponent(project)}`);

load();
</script>
</body>
</html>
