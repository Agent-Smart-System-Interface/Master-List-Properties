<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>smart properties system</title>

  <style>
    :root{
      --line-bg:#8CABD9;
      --cloud-a:rgba(244,252,255,.26);
      --cloud-b:rgba(244,252,255,.18);
      --chat-green:#9DE593;
      --line-green:#06c755;
      --text:#111827;
      --muted:rgba(17,24,39,.55);
      --card:#ffffff;
      --stroke:rgba(0,0,0,.06);
      --shadow:0 10px 26px rgba(0,0,0,.10);
      --radius:30px;
      --font:"LINE Seed Sans TH","LINE Seed Sans","Noto Sans Thai","Noto Sans Thai UI",
              system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:var(--line-bg);
      color:var(--text);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(120px 80px at 12% 22%, var(--cloud-a) 0 60%, transparent 61%),
        radial-gradient(160px 100px at 30% 24%, var(--cloud-a) 0 58%, transparent 59%),
        radial-gradient(130px 90px at 50% 20%, var(--cloud-b) 0 56%, transparent 57%),
        radial-gradient(200px 120px at 85% 28%, var(--cloud-a) 0 56%, transparent 57%),
        radial-gradient(160px 110px at 78% 62%, var(--cloud-b) 0 56%, transparent 57%),
        radial-gradient(220px 140px at 18% 78%, var(--cloud-a) 0 56%, transparent 57%),
        radial-gradient(180px 120px at 62% 86%, var(--cloud-b) 0 56%, transparent 57%);
    }

    .wrap{
      max-width:420px;
      margin:0 auto;
      padding:14px 14px 22px;
    }

    /* top (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏ô LINE) */
    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .leftGroup{display:flex; align-items:center; gap:10px}
    .iconBtn{
      width:44px; height:44px;
      border:none;
      border-radius:18px;
      background:rgba(255,255,255,.85);
      box-shadow:0 10px 26px rgba(0,0,0,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .iconBtn:active{transform:translateY(1px)}
    .headText{min-width:0}
    .hTitle{
      margin:0;
      font-size:14px;
      font-weight:900;
      letter-spacing:.2px;
      color:rgba(17,24,39,.95);
    }
    .hSub{
      margin:3px 0 0;
      font-size:12px;
      font-weight:800;
      color:rgba(17,24,39,.55);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }

    .panel{
      background:rgba(255,255,255,.94);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    /* slider */
    .slider{
      position:relative;
      border-radius:26px;
      overflow:hidden;
      background:rgba(0,0,0,.06);
      aspect-ratio: 16 / 10;
    }
    .slider img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÅ‡∏ö‡∏ö‡πÉ‡∏™ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß) */
    .navBtn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:48px; height:48px;
      border:none;
      border-radius:18px;
      cursor:pointer;
      background:rgba(17,24,39,.22);
      backdrop-filter:blur(10px);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .navBtn:active{transform:translateY(-50%) scale(.98)}
    .navPrev{left:10px}
    .navNext{right:10px}

    .counter{
      position:absolute;
      right:10px; top:10px;
      background:rgba(255,255,255,.88);
      color:rgba(17,24,39,.95);
      border:1px solid rgba(0,0,0,.06);
      padding:8px 12px;
      font-weight:900;
      border-radius:18px;
      font-size:14px;
    }

    .thumbs{
      display:flex;
      gap:10px;
      margin-top:10px;
      overflow:auto;
      padding-bottom:2px;
    }
    .thumbMini{
      width:84px; height:54px;
      border-radius:14px;
      overflow:hidden;
      border:2px solid transparent;
      background:rgba(0,0,0,.06);
      flex:0 0 auto;
      cursor:pointer;
    }
    .thumbMini img{width:100%; height:100%; object-fit:cover}
    .thumbMini.active{border-color:rgba(17,24,39,.65)}

    .section{
      margin-top:12px;
    }
    .pills{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:10px;
    }
    .pill{
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(17,24,39,.06);
      font-size:14px;
    }
    .pillBadge{background:rgba(157,229,147,.60)}
    .pillSoft{background:rgba(17,24,39,.04)}
    .bigPrice{
      margin:14px 0 6px;
      font-size:44px;
      font-weight:1000;
      letter-spacing:-.5px;
      line-height:1;
    }
    .gridChips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(17,24,39,.04);
      font-size:16px;
    }

    .label{
      margin-top:12px;
      font-size:18px;
      font-weight:1000;
      letter-spacing:.2px;
      color:rgba(17,24,39,.85);
    }
    .desc{
      margin-top:8px;
      font-size:14px;
      font-weight:800;
      color:rgba(17,24,39,.65);
      line-height:1.55;
      white-space:pre-wrap;
    }

    .btnRow{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .actionBtn{
      text-decoration:none;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:18px;
      padding:12px 12px;
      font-weight:1000;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(255,255,255,.92);
      color:rgba(17,24,39,.90);
      box-shadow:0 10px 26px rgba(0,0,0,.08);
    }
    .actionBtn.primary{
      background:rgba(17,24,39,.18);
      color:#fff;
      border-color:rgba(255,255,255,.12);
    }
    .actionBtn.disabled{
      opacity:.45;
      pointer-events:none;
    }

    .skeleton{
      background:linear-gradient(90deg, rgba(255,255,255,.55), rgba(255,255,255,.25), rgba(255,255,255,.55));
      background-size:200% 100%;
      animation:shimmer 1.2s infinite;
      border-radius:16px;
    }
    @keyframes shimmer{0%{background-position:0% 0}100%{background-position:-200% 0}}
    .skLine{height:14px; margin-top:10px}
    .skBig{height:56px; margin-top:12px; border-radius:22px}

    .errBox{
      margin-top:12px;
      background:rgba(255,255,255,.94);
      border:1px solid rgba(255,255,255,.16);
      border-radius:24px;
      padding:14px;
      box-shadow:var(--shadow);
      font-weight:900;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topRow">
      <div class="leftGroup">
        <button class="iconBtn" id="btnBack" aria-label="Back" title="Back">
          <!-- chevron -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M15 18l-6-6 6-6" stroke="rgba(17,24,39,.9)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="headText">
          <p class="hTitle" id="headTitle">UNIT DETAILS</p>
          <p class="hSub" id="headSub">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>
      </div>

      <button class="iconBtn" id="btnHome" aria-label="Home" title="Home">
        <!-- home -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M3 11l9-8 9 8" stroke="rgba(17,24,39,.9)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 10.5V21h14V10.5" stroke="rgba(17,24,39,.9)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="panel" id="content">

      <!-- Skeleton while loading -->
      <div id="sk">
        <div class="skeleton" style="aspect-ratio:16/10; border-radius:26px;"></div>
        <div class="skLine skeleton" style="width:55%"></div>
        <div class="skLine skeleton" style="width:78%"></div>
        <div class="skBig skeleton" style="width:95%"></div>
        <div class="skLine skeleton" style="width:88%"></div>
        <div class="skLine skeleton" style="width:66%"></div>
      </div>

      <!-- Real UI -->
      <div id="ui" style="display:none;">
        <div class="slider" id="slider">
          <img id="mainImg" alt="">
          <button class="navBtn navPrev" id="prevBtn" aria-label="Prev">‚Äπ</button>
          <button class="navBtn navNext" id="nextBtn" aria-label="Next">‚Ä∫</button>
          <div class="counter" id="counter">1/1</div>
        </div>

        <div class="thumbs" id="thumbs"></div>

        <div class="section">
          <div class="pills" id="pills"></div>

          <div class="bigPrice" id="price">-</div>

          <div class="gridChips" id="chips"></div>

          <div class="label" id="title2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
          <div class="desc" id="desc">-</div>

          <div class="btnRow">
            <a class="actionBtn primary" id="btnMap" href="#" target="_blank" rel="noopener">Google Map</a>
            <a class="actionBtn disabled" id="btnFB" href="#" target="_blank" rel="noopener">Facebook</a>
          </div>
        </div>
      </div>

    </div>

    <div id="err" style="display:none;" class="errBox"></div>
  </div>

<script>
  // ‚úÖ API URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏™‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß)
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  const $ = (id)=>document.getElementById(id);

  const qs = new URLSearchParams(location.search);
  const hpId = qs.get("hpId") || qs.get("id") || "";
  const project = qs.get("project") || "Project_0";

  // navigation
  $("btnBack").addEventListener("click", ()=>{
    if(history.length > 1) history.back();
    else location.href = "index.html?project=" + encodeURIComponent(project);
  });
  $("btnHome").addEventListener("click", ()=>{
    location.href = "index.html?project=" + encodeURIComponent(project);
  });

  function safeText(v){ return (v===undefined || v===null) ? "" : String(v); }

  function formatPriceTHB(n){
    const raw = String(n ?? "").trim();
    const num = Number(raw.replace(/,/g,""));
    if(!raw) return "-";
    if(!isFinite(num)) return raw;
    return "‡∏ø" + num.toLocaleString("en-US");
  }

  function parseGallery(detail){
    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ normKey ‡πÉ‡∏ô Apps Script
    const thumb = safeText(detail.Thumbnail_Image || detail.thumbnail_image || detail.thumbnail || "");
    const listStr = safeText(detail.Image_List || detail.image_list || "");
    const links = listStr.split(",").map(s=>s.trim()).filter(Boolean);
    const all = [];
    if(thumb) all.push(thumb);
    for(const u of links){
      if(!all.includes(u)) all.push(u);
    }
    return all.length ? all : (thumb ? [thumb] : []);
  }

  async function fetchDetail(){
    if(!hpId) throw new Error("Missing id (hpId). ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: details.html?id=HP-0003&project=Project_0");
    const url = `${API_URL}?mode=getUnitDetail&project=${encodeURIComponent(project)}&hpId=${encodeURIComponent(hpId)}&t=${Date.now()}`;
    const res = await fetch(url, { cache:"no-store" });
    const data = await res.json();
    if(data && data.error) throw new Error(data.error);
    return data || {};
  }

  // slider state
  let images = [];
  let idx = 0;

  function setMain(i){
    if(!images.length) return;
    idx = (i + images.length) % images.length;
    $("mainImg").src = images[idx];
    $("counter").textContent = `${idx+1}/${images.length}`;

    // thumbs active
    const nodes = $("thumbs").querySelectorAll(".thumbMini");
    nodes.forEach((n, k)=> n.classList.toggle("active", k===idx));
  }

  function buildThumbs(){
    $("thumbs").innerHTML = images.map((src, i)=>`
      <div class="thumbMini ${i===0?'active':''}" data-i="${i}">
        <img src="${src}" alt="">
      </div>
    `).join("");

    $("thumbs").addEventListener("click",(e)=>{
      const box = e.target.closest(".thumbMini");
      if(!box) return;
      const i = Number(box.getAttribute("data-i"));
      setMain(i);
    }, { once:false });
  }

  function setLink(btn, url){
    if(url && String(url).trim()){
      btn.href = url;
      btn.classList.remove("disabled");
    }else{
      btn.href = "#";
      btn.classList.add("disabled");
    }
  }

  function render(detail){
    // header
    const plot = safeText(detail.Plot || detail.plot || "-");
    const hp = safeText(detail.HP_ID || detail.hp_id || hpId);
    const projectName = safeText(detail.Project_Name || detail.project_name || project);
    $("headTitle").textContent = "UNIT DETAILS";
    $("headSub").textContent = `${projectName} ‚Ä¢ ${hp} ‚Ä¢ ${plot}`;

    // images
    images = parseGallery(detail);
    if(!images.length){
      images = ["data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="750">
          <rect width="100%" height="100%" fill="#e5e7eb"/>
          <text x="50%" y="50%" font-family="Arial" font-size="48" fill="#6b7280" text-anchor="middle">No Image</text>
        </svg>
      `)];
    }
    buildThumbs();
    setMain(0);

    // pills
    const badge = safeText(detail.Badge || detail.badge || "");
    const status = safeText(detail.Status || detail.status || "");
    const sysStatus = safeText(detail.System_Status || detail.system_status || "");
    const last = safeText(detail.Last_Updated || detail.last_updated || "");

    const pills = [];
    if(badge) pills.push(`<div class="pill pillBadge">Badge: ${badge}</div>`);
    if(sysStatus) pills.push(`<div class="pill pillSoft">System: ${sysStatus}</div>`);
    if(last) pills.push(`<div class="pill pillSoft">Updated: ${last}</div>`);
    if(status) pills.push(`<div class="pill pillSoft">Status: ${status}</div>`);
    $("pills").innerHTML = pills.join("");

    // price
    $("price").textContent = formatPriceTHB(detail.Price || detail.price || "");

    // chips
    const b = safeText(detail.Bedrooms || detail.bedrooms || "-");
    const ba = safeText(detail.Bathrooms || detail.bathrooms || "-");
    const land = safeText(detail.Land_Area_sq_w || detail.land_area_sq_w || "-");
    const living = safeText(detail.Living_Area_sq_m || detail.living_area_sq_m || "-");

    $("chips").innerHTML = `
      <div class="chip">üõè ${b}</div>
      <div class="chip">üõÅ ${ba}</div>
      <div class="chip">üìê ${land} sq.w</div>
      <div class="chip">üè† ${living} sqm</div>
    `;

    // desc
    const desc = safeText(detail.Description || detail.description || "");
    $("desc").textContent = desc || "-";

    // links
    setLink($("btnMap"), safeText(detail.Map_Link || detail.map_link || ""));
    setLink($("btnFB"), safeText(detail.FBLink || detail.fblink || detail.fb_link || ""));

    // show ui
    $("sk").style.display = "none";
    $("ui").style.display = "block";
  }

  // slider controls
  $("prevBtn").addEventListener("click", ()=> setMain(idx-1));
  $("nextBtn").addEventListener("click", ()=> setMain(idx+1));

  // swipe (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
  (function enableSwipe(){
    const el = $("slider");
    let startX = 0, startY = 0, moved = false;

    el.addEventListener("touchstart",(e)=>{
      const t = e.touches[0];
      startX = t.clientX; startY = t.clientY; moved=false;
    }, {passive:true});

    el.addEventListener("touchmove",(e)=>{
      const t = e.touches[0];
      const dx = t.clientX - startX;
      const dy = t.clientY - startY;
      if(Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 18) moved=true;
    }, {passive:true});

    el.addEventListener("touchend",(e)=>{
      if(!moved) return;
      // ‡πÉ‡∏ä‡πâ endX ‡∏à‡∏≤‡∏Å changedTouches
      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;
      const dx = t.clientX - startX;
      if(dx > 24) setMain(idx-1);
      else if(dx < -24) setMain(idx+1);
    }, {passive:true});
  })();

  // init
  (async function init(){
    try{
      const detail = await fetchDetail();
      render(detail);
    }catch(err){
      $("content").style.display = "none";
      $("err").style.display = "block";
      $("err").textContent = "Error: " + err.message;
      $("headSub").textContent = "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    }
  })();
</script>

</body>
</html>
