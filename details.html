<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UNIT DETAILS</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Kanit', sans-serif; }
    .price-text { font-size: clamp(2.2rem, 5vw, 3.3rem); font-weight: 700; letter-spacing: -0.03em; line-height: 1.05; }
    .muted { color:#94a3b8; }
    .pill { padding:.55rem 1rem; border-radius:999px; font-weight:600; font-size:.95rem; }
    .soft-card { border-radius: 2.2rem; overflow:hidden; box-shadow: 0 10px 30px rgba(2,6,23,.10); }
    .thumb { border-radius: 1.25rem; overflow:hidden; border: 2px solid transparent; }
    .thumb.active { border-color:#0f172a; }
    .thumb img { width:100%; height:100%; object-fit:cover; display:block; }

    /* ✅ Arrow buttons: no white background, subtle, not blocking photo */
    .nav-btn{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width:56px;
      height:56px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: transparent;          /* <— no background */
      border: none;
      color: rgba(255,255,255,.85);     /* light arrow */
      font-size: 44px;
      line-height: 1;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      text-shadow: 0 6px 18px rgba(0,0,0,.40); /* make arrow visible on bright images */
      transition: transform .12s ease, color .12s ease, opacity .12s ease;
      opacity: .85;
    }
    .nav-btn:hover{ opacity: 1; transform: translateY(-50%) scale(1.04); }
    .nav-btn:active{ transform: translateY(-50%) scale(.96); }
    .nav-left{ left: 14px; }
    .nav-right{ right: 14px; }

    /* Mobile smaller arrows */
    @media (max-width: 640px){
      .nav-btn{ width:46px; height:46px; font-size:38px; }
      .nav-left{ left: 10px; }
      .nav-right{ right: 10px; }
    }

    /* Ensure no accidental "popup-like" behaviors */
    img { -webkit-user-drag: none; }
  </style>
</head>

<body class="bg-slate-50">
  <div class="max-w-6xl mx-auto px-4 py-6 md:py-10">

    <!-- Header -->
    <div class="flex items-start justify-between gap-4 mb-6">
      <div class="min-w-0">
        <h1 id="title" class="text-3xl md:text-5xl font-extrabold italic text-slate-900 truncate">
          UNIT
        </h1>
        <div id="subtitle" class="mt-2 text-base md:text-lg muted">
          Project: - • Unit: -
        </div>
      </div>

      <div class="flex gap-3 shrink-0">
        <button onclick="history.back()"
          class="w-12 h-12 md:w-14 md:h-14 rounded-2xl bg-white shadow flex items-center justify-center text-xl"
          title="Back">←</button>

        <a id="homeBtn" href="index.html"
          class="w-12 h-12 md:w-14 md:h-14 rounded-2xl bg-slate-900 text-white shadow flex items-center justify-center text-xl"
          title="Home">⌂</a>
      </div>
    </div>

    <!-- Main gallery card -->
    <div class="soft-card bg-white">
      <div class="relative">
        <img id="mainImg" src="" alt="Property photo" class="w-full h-[320px] sm:h-[420px] md:h-[520px] object-cover">

        <!-- plot pill -->
        <div id="plotPill" class="absolute top-4 left-4 bg-white/90 px-4 py-2 rounded-full font-semibold">
          -
        </div>

        <!-- status pill -->
        <div id="statusPill" class="absolute top-4 right-4 px-4 py-2 rounded-full font-semibold">
          -
        </div>

        <!-- ✅ arrows (no background) -->
        <button id="prevBtn" class="nav-btn nav-left" aria-label="Previous photo" title="Previous">‹</button>
        <button id="nextBtn" class="nav-btn nav-right" aria-label="Next photo" title="Next">›</button>

        <!-- counter -->
        <div id="counter" class="absolute bottom-4 right-4 bg-white/90 px-4 py-2 rounded-full font-semibold">
          1 / 1
        </div>
      </div>

      <!-- thumbs row -->
      <div class="p-4 md:p-6">
        <div id="thumbRow" class="flex gap-3 overflow-x-auto pb-2">
          <!-- thumbs injected -->
        </div>
      </div>
    </div>

    <!-- Info card -->
    <div class="mt-6 bg-white soft-card p-6 md:p-8">
      <div class="flex flex-wrap gap-3 mb-5">
        <div id="badgePill" class="pill bg-violet-100 text-violet-700">Badge: -</div>
        <div id="sysPill" class="pill bg-slate-100 text-slate-700">System: -</div>
        <div id="updated" class="w-full muted font-semibold">Updated: -</div>
      </div>

      <div class="price-text text-slate-900" id="price">฿0</div>
      <div class="mt-5 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
        <div class="bg-slate-100 rounded-2xl p-4"><div class="muted">Bedrooms</div><div id="bed" class="text-lg font-semibold">-</div></div>
        <div class="bg-slate-100 rounded-2xl p-4"><div class="muted">Bathrooms</div><div id="bath" class="text-lg font-semibold">-</div></div>
        <div class="bg-slate-100 rounded-2xl p-4"><div class="muted">Land (sq.w)</div><div id="landSqw" class="text-lg font-semibold">-</div></div>
        <div class="bg-slate-100 rounded-2xl p-4"><div class="muted">Living (sqm)</div><div id="livingSqm" class="text-lg font-semibold">-</div></div>
      </div>

      <div class="mt-6">
        <div class="text-sm muted font-semibold mb-2">Description</div>
        <div id="desc" class="text-slate-800 leading-relaxed">-</div>
      </div>

      <div class="mt-6 flex flex-wrap gap-3">
        <a id="mapBtn" href="#" target="_blank"
           class="px-5 py-3 rounded-2xl bg-slate-900 text-white font-semibold">
          OPEN MAP
        </a>
        <a id="fbBtn" href="#" target="_blank"
           class="px-5 py-3 rounded-2xl bg-blue-600 text-white font-semibold">
          FACEBOOK / LISTING
        </a>
      </div>
    </div>

    <div id="loading" class="text-center text-slate-400 py-10">Loading...</div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  const qs = new URLSearchParams(location.search);
  const PROJECT = qs.get("project") || "Project_0";

  // ✅ you use details.html not detail.html
  // home button keeps project
  document.getElementById("homeBtn").href = `index.html?project=${encodeURIComponent(PROJECT)}`;

  const ID = qs.get("id") || qs.get("hpId") || "";
  const loadingEl = document.getElementById("loading");

  const priceFmt = v => {
    const n = Number(v);
    return (!n || n === 0) ? "฿0" : "฿" + n.toLocaleString();
  };

  const statusClass = s => {
    s = String(s || "").toLowerCase();
    if (s.includes("available")) return "bg-emerald-100 text-emerald-700";
    if (s.includes("under")) return "bg-sky-100 text-sky-700";
    if (s.includes("reserved")) return "bg-amber-100 text-amber-700";
    if (s.includes("sold")) return "bg-rose-100 text-rose-700";
    return "bg-slate-100 text-slate-700";
  };

  let images = [];
  let current = 0;

  function cleanUrl(u){
    return String(u||"").trim();
  }

  function setMain(i){
    if(!images.length) return;
    current = (i + images.length) % images.length;
    const mainImg = document.getElementById("mainImg");
    mainImg.src = images[current];
    document.getElementById("counter").textContent = `${current+1} / ${images.length}`;

    // thumbs active state
    const thumbs = document.querySelectorAll("[data-thumb]");
    thumbs.forEach((t, idx) => {
      if(idx === current) t.classList.add("active");
      else t.classList.remove("active");
    });
  }

  function renderThumbs(){
    const row = document.getElementById("thumbRow");
    row.innerHTML = images.map((src, idx) => `
      <button data-thumb class="thumb ${idx===0 ? "active" : ""} shrink-0 w-[92px] h-[64px] md:w-[120px] md:h-[78px] bg-slate-200"
              title="Photo ${idx+1}">
        <img src="${src}" alt="thumb ${idx+1}">
      </button>
    `).join("");

    const thumbs = row.querySelectorAll("[data-thumb]");
    thumbs.forEach((btn, idx) => {
      btn.addEventListener("click", () => setMain(idx));
    });
  }

  // ✅ No popup: no modal code at all.
  // Add swipe support (mobile)
  function enableSwipe(){
    const img = document.getElementById("mainImg");
    let x0 = null;

    img.addEventListener("touchstart", (e) => {
      x0 = e.touches[0].clientX;
    }, {passive:true});

    img.addEventListener("touchend", (e) => {
      if(x0 === null) return;
      const x1 = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : x0;
      const dx = x1 - x0;
      x0 = null;
      if(Math.abs(dx) < 40) return;
      if(dx > 0) setMain(current - 1);
      else setMain(current + 1);
    }, {passive:true});
  }

  async function load(){
    try{
      if(!ID){
        loadingEl.textContent = "Missing id (e.g. ?id=HP-Z001&project=Project_0)";
        return;
      }

      // API expects hpId
      const res = await fetch(`${API_URL}?mode=getUnitDetail&project=${encodeURIComponent(PROJECT)}&hpId=${encodeURIComponent(ID)}&t=${Date.now()}`);
      const d = await res.json();

      if(d.error){
        loadingEl.textContent = d.error;
        return;
      }

      // Title
      const plot = d.Plot || d.plot || "-";
      document.getElementById("title").textContent = `UNIT ${ID} • ${plot}`;
      document.getElementById("subtitle").textContent = `Project: ${PROJECT} • Unit: ${ID}`;

      // Pills
      document.getElementById("plotPill").textContent = plot;

      const status = d.Status || d.status || "-";
      const statusPill = document.getElementById("statusPill");
      statusPill.className = `absolute top-4 right-4 px-4 py-2 rounded-full font-semibold ${statusClass(status)}`;
      statusPill.textContent = status;

      document.getElementById("badgePill").textContent = `Badge: ${d.Badge || d.badge || "-"}`;
      document.getElementById("sysPill").textContent = `System: ${d.System_Status || d.sysStatus || "-"}`;
      document.getElementById("updated").textContent = `Updated: ${d.Last_Updated || d.lastUpdated || "-"}`;

      // Price and facts
      document.getElementById("price").textContent = priceFmt(d.Price || d.price || 0);
      document.getElementById("bed").textContent = d.Bedrooms || d.bedrooms || "-";
      document.getElementById("bath").textContent = d.Bathrooms || d.bathrooms || "-";
      document.getElementById("landSqw").textContent = d.Land_Area_sq_w || d.landSqw || "-";
      document.getElementById("livingSqm").textContent = d.Living_Area_sq_m || d.livingSqm || "-";
      document.getElementById("desc").textContent = d.Description || d.description || "-";

      // Links
      const map = d.Map_Link || d.map_link || d.map || "";
      const fb  = d.FBLink || d.fblink || d.fb || "";
      const mapBtn = document.getElementById("mapBtn");
      const fbBtn  = document.getElementById("fbBtn");

      mapBtn.href = map ? map : "#";
      fbBtn.href  = fb ? fb : "#";
      if(!map) mapBtn.classList.add("opacity-40","pointer-events-none");
      if(!fb)  fbBtn.classList.add("opacity-40","pointer-events-none");

      // Images: Thumbnail + Image_List
      const thumb = cleanUrl(d.Thumbnail_Image || d.thumbnail || "");
      const listRaw = cleanUrl(d.Image_List || d.image_list || "");
      const list = listRaw ? listRaw.split(",").map(s => cleanUrl(s)).filter(Boolean) : [];

      // Ensure unique and keep order
      const seen = new Set();
      images = [];
      [thumb, ...list].forEach(u => {
        if(u && !seen.has(u)){
          seen.add(u);
          images.push(u);
        }
      });

      if(!images.length){
        images = ["https://via.placeholder.com/1200x700?text=No+Image"];
      }

      renderThumbs();
      setMain(0);
      enableSwipe();

      // Arrows
      document.getElementById("prevBtn").addEventListener("click", () => setMain(current - 1));
      document.getElementById("nextBtn").addEventListener("click", () => setMain(current + 1));

      // Keyboard (desktop)
      window.addEventListener("keydown", (e) => {
        if(e.key === "ArrowLeft") setMain(current - 1);
        if(e.key === "ArrowRight") setMain(current + 1);
      });

      loadingEl.style.display = "none";

    }catch(err){
      loadingEl.textContent = "Load error: " + err;
    }
  }

  load();
</script>
</body>
</html>
