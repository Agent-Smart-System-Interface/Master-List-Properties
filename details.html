<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNIT DETAILS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Kanit', sans-serif; }

    /* ‚úÖ LINE-like Background + soft clouds */
    body.line-bg{
      background: linear-gradient(180deg,#8fb6e3 0%, #a9c9ef 35%, #cfe3f7 100%);
      min-height: 100vh;
    }
    body.line-bg::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .22;
      background-repeat: repeat;
      background-size: 900px 520px;
      background-position: center top;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='900' height='520' viewBox='0 0 900 520'%3E%3Cg fill='%23ffffff'%3E%3Cpath opacity='.55' d='M160 150c-32 0-58 20-65 47-3-1-7-1-10-1-22 0-40 14-46 33-1 4-2 8-2 12 0 24 20 44 45 44h172c26 0 47-20 47-44s-21-44-47-44c-6 0-11 1-16 3-9-27-35-50-78-50z'/%3E%3Cpath opacity='.45' d='M630 110c-28 0-50 17-57 40-3-1-6-1-9-1-18 0-33 11-38 27-1 3-1 6-1 10 0 20 16 36 36 36h150c21 0 38-16 38-36s-17-36-38-36c-5 0-9 1-14 2-8-23-28-42-67-42z'/%3E%3Cpath opacity='.35' d='M500 320c-38 0-68 24-76 56-4-1-8-2-12-2-25 0-46 16-52 38-2 5-2 10-2 15 0 29 24 53 53 53h208c31 0 56-24 56-53s-25-53-56-53c-7 0-13 1-19 3-10-33-40-57-100-57z'/%3E%3C/g%3E%3C/svg%3E");
    }

    .card{
      background: rgba(255,255,255,.92);
      border-radius: 28px;
      box-shadow: 0 14px 40px rgba(2,6,23,.12);
      overflow: hidden;
      backdrop-filter: blur(8px);
    }

    /* ‚úÖ Arrow buttons: no white background, subtle */
    .arrowBtn{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width: 52px; height: 52px;
      border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(15,23,42,.10);      /* ‡∏à‡∏≤‡∏á‡πÜ ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏£‡∏π‡∏õ */
      border: 1px solid rgba(255,255,255,.28);
      color: rgba(255,255,255,.85);
      box-shadow: 0 10px 24px rgba(2,6,23,.18);
      backdrop-filter: blur(6px);
      transition: transform .12s ease, opacity .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .arrowBtn:hover{ background: rgba(15,23,42,.16); }
    .arrowBtn:active{ transform: translateY(-50%) scale(.96); }
    .arrowLeft{ left: 12px; }
    .arrowRight{ right: 12px; }

    /* thumbs */
    .thumb{
      border-radius: 18px;
      overflow:hidden;
      border: 2px solid transparent;
      background:#e2e8f0;
      box-shadow: 0 8px 18px rgba(2,6,23,.10);
      -webkit-tap-highlight-color: transparent;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .thumb.active{ border-color: rgba(15,23,42,.85); }

    /* main photo frame */
    .hero{
      position: relative;
      border-radius: 28px;
      overflow: hidden;
      background: #e2e8f0;
    }
    .hero img{
      width: 100%;
      height: clamp(260px, 42vw, 520px);
      object-fit: cover;
      display:block;
    }

    /* photo loading overlay (prevents "broken" look before real image) */
    .photoLoading{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background: linear-gradient(90deg, rgba(226,232,240,.65) 25%, rgba(248,250,252,.75) 37%, rgba(226,232,240,.65) 63%);
      background-size: 400% 100%;
      animation: shimmer 1.2s ease infinite;
      color:#334155;
      font-weight: 700;
      letter-spacing: .06em;
    }
    @keyframes shimmer { 0%{background-position:100% 0} 100%{background-position:0 0} }

    /* counter */
    .counterPill{
      position:absolute;
      bottom: 14px;
      right: 14px;
      background: rgba(255,255,255,.88);
      color:#0f172a;
      padding: 10px 14px;
      border-radius: 16px;
      font-weight: 800;
      box-shadow: 0 10px 22px rgba(2,6,23,.14);
      backdrop-filter: blur(6px);
    }

    /* top right nav buttons */
    .navBtn{
      width: 52px;
      height: 52px;
      border-radius: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 24px rgba(2,6,23,.10);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
  </style>
</head>

<body class="line-bg">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <div class="flex items-start justify-between mb-6">
      <div>
        <div class="text-5xl font-black italic tracking-tight text-slate-900" id="title">UNIT</div>
        <div class="text-slate-500 font-semibold mt-2" id="subtitle">Project: - ‚Ä¢ Unit: -</div>
      </div>

      <div class="flex gap-3">
        <a class="navBtn bg-white/90" href="index.html" title="Back">
          ‚Üê
        </a>
        <a class="navBtn bg-slate-900 text-white" href="index.html" title="Home">
          ‚åÇ
        </a>
      </div>
    </div>

    <!-- error box -->
    <div id="errBox" class="hidden card p-10 text-center">
      <div class="text-2xl font-extrabold text-slate-900 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div class="text-slate-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Index ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
      <a href="index.html" class="inline-block mt-6 bg-slate-900 text-white px-6 py-3 rounded-2xl font-semibold">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Index</a>
    </div>

    <!-- main card -->
    <div id="app" class="hidden card p-6 md:p-8">
      <div class="hero">
        <img id="mainImg" alt="main photo" />
        <div id="photoLoading" class="photoLoading">LOADING PHOTO‚Ä¶</div>

        <div id="plotPill" class="absolute top-4 left-4 bg-white/90 px-4 py-2 rounded-full font-bold shadow">-</div>
        <div id="statusPill" class="absolute top-4 right-4 px-4 py-2 rounded-full font-bold shadow">-</div>

        <button id="prevBtn" class="arrowBtn arrowLeft" aria-label="previous">‚Äπ</button>
        <button id="nextBtn" class="arrowBtn arrowRight" aria-label="next">‚Ä∫</button>

        <div id="counter" class="counterPill">1 / 1</div>
      </div>

      <div class="mt-4">
        <div id="thumbRow" class="flex gap-3 overflow-x-auto pb-2"></div>
      </div>

      <div class="mt-6 flex flex-wrap gap-3">
        <div id="badgePill" class="bg-violet-100 text-violet-700 px-5 py-3 rounded-full font-bold">Badge: -</div>
        <div id="sysPill" class="bg-slate-100 text-slate-700 px-5 py-3 rounded-full font-bold">System: -</div>
        <div id="updated" class="w-full text-slate-500 font-semibold mt-2">Updated: -</div>
      </div>

      <div class="mt-8">
        <div class="text-5xl font-black text-slate-900" id="price">‡∏ø0</div>
        <div class="mt-4 flex flex-wrap gap-2">
          <div class="bg-slate-100 px-4 py-2 rounded-full font-semibold">üõè <span id="bed">-</span></div>
          <div class="bg-slate-100 px-4 py-2 rounded-full font-semibold">üõÅ <span id="bath">-</span></div>
          <div class="bg-slate-100 px-4 py-2 rounded-full font-semibold">üìê <span id="landSqw">-</span> sq.w</div>
          <div class="bg-slate-100 px-4 py-2 rounded-full font-semibold">üè† <span id="livingSqm">-</span> sqm</div>
        </div>

        <div class="mt-6 text-slate-700 leading-relaxed font-medium" id="desc">-</div>

        <div class="mt-8 flex gap-3 flex-wrap">
          <a id="mapBtn" class="bg-slate-900 text-white px-6 py-3 rounded-2xl font-semibold" target="_blank" rel="noopener">Google Map</a>
          <a id="fbBtn" class="bg-white text-slate-900 px-6 py-3 rounded-2xl font-semibold border border-slate-200" target="_blank" rel="noopener">Facebook</a>
        </div>
      </div>
    </div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

  const qs = new URLSearchParams(location.search);
  const ID = qs.get("id") || "";                 // details.html?id=HP-xxxx
  const PROJECT = qs.get("project") || "Project_0";

  const app = document.getElementById("app");
  const errBox = document.getElementById("errBox");
  const photoLoading = document.getElementById("photoLoading");

  let images = [];
  let current = 0;

  const priceFmt = v => {
    const n = Number(v);
    return (!n || n === 0) ? "‡∏ø0" : "‡∏ø" + n.toLocaleString();
  };

  const statusClass = s => {
    s = String(s || "").toLowerCase();
    if (s.includes("available")) return "bg-emerald-100 text-emerald-700";
    if (s.includes("under")) return "bg-sky-100 text-sky-700";
    if (s.includes("reserved")) return "bg-amber-100 text-amber-700";
    if (s.includes("sold")) return "bg-rose-100 text-rose-700";
    return "bg-white/90 text-slate-700";
  };

  function cleanUrl(u){
    return String(u || "").trim().replace(/^"+|"+$/g,'');
  }

  function showApp(){ app.classList.remove("hidden"); }

  function waitImageLoad(imgEl, src, timeoutMs=8000){
    return new Promise((resolve) => {
      let done = false;
      const timer = setTimeout(() => { if(done) return; done = true; resolve(false); }, timeoutMs);

      imgEl.onload = () => { if(done) return; done = true; clearTimeout(timer); resolve(true); };
      imgEl.onerror = () => { if(done) return; done = true; clearTimeout(timer); resolve(false); };

      imgEl.src = src;
    });
  }

  function setMain(i){
    if(!images.length) return;
    current = (i + images.length) % images.length;

    photoLoading.classList.remove("hidden");
    const mainImg = document.getElementById("mainImg");

    waitImageLoad(mainImg, images[current]).then(() => {
      photoLoading.classList.add("hidden");
    });

    document.getElementById("counter").textContent = `${current+1} / ${images.length}`;

    const thumbs = document.querySelectorAll("[data-thumb]");
    thumbs.forEach((t, idx) => idx === current ? t.classList.add("active") : t.classList.remove("active"));
  }

  function renderThumbs(){
    const row = document.getElementById("thumbRow");
    row.innerHTML = images.map((src, idx) => `
      <button data-thumb class="thumb ${idx===0 ? "active" : ""} shrink-0 w-[92px] h-[64px] md:w-[120px] md:h-[78px]" title="Photo ${idx+1}">
        <img src="${src}" alt="thumb ${idx+1}" loading="lazy" decoding="async">
      </button>
    `).join("");

    row.querySelectorAll("[data-thumb]").forEach((btn, idx) => {
      btn.addEventListener("click", () => setMain(idx));
    });
  }

  function enableSwipe(){
    const img = document.getElementById("mainImg");
    let x0 = null;

    img.addEventListener("touchstart", (e) => { x0 = e.touches[0].clientX; }, {passive:true});
    img.addEventListener("touchend", (e) => {
      if(x0 === null) return;
      const x1 = e.changedTouches[0].clientX;
      const dx = x1 - x0;
      x0 = null;
      if(Math.abs(dx) < 40) return;
      if(dx > 0) setMain(current - 1);
      else setMain(current + 1);
    }, {passive:true});
  }

  async function load(){
    if(!ID){
      errBox.classList.remove("hidden");
      showApp();
      return;
    }

    try{
      const res = await fetch(`${API_URL}?mode=getUnitDetail&project=${encodeURIComponent(PROJECT)}&hpId=${encodeURIComponent(ID)}&t=${Date.now()}`);
      const d = await res.json();

      if(d.error){
        errBox.classList.remove("hidden");
        showApp();
        return;
      }

      const plot = d.Plot || d.plot || "-";
      document.getElementById("title").textContent = `UNIT ${ID} ‚Ä¢ ${plot}`;
      document.getElementById("subtitle").textContent = `Project: ${PROJECT} ‚Ä¢ Unit: ${ID}`;
      document.getElementById("plotPill").textContent = plot;

      const status = d.Status || d.status || "-";
      const statusPill = document.getElementById("statusPill");
      statusPill.className = `absolute top-4 right-4 px-4 py-2 rounded-full font-bold shadow ${statusClass(status)}`;
      statusPill.textContent = status;

      document.getElementById("badgePill").textContent = `Badge: ${d.Badge || d.badge || "-"}`;
      document.getElementById("sysPill").textContent = `System: ${d.System_Status || d.sysStatus || "-"}`;
      document.getElementById("updated").textContent = `Updated: ${d.Last_Updated || d.lastUpdated || "-"}`;

      document.getElementById("price").textContent = priceFmt(d.Price || d.price || 0);
      document.getElementById("bed").textContent = d.Bedrooms || d.bedrooms || "-";
      document.getElementById("bath").textContent = d.Bathrooms || d.bathrooms || "-";
      document.getElementById("landSqw").textContent = d.Land_Area_sq_w || d.landSqw || "-";
      document.getElementById("livingSqm").textContent = d.Living_Area_sq_m || d.livingSqm || "-";
      document.getElementById("desc").textContent = d.Description || d.description || "-";

      const map = d.Map_Link || "";
      const fb  = d.FBLink || "";
      const mapBtn = document.getElementById("mapBtn");
      const fbBtn  = document.getElementById("fbBtn");
      mapBtn.href = map ? map : "#";
      fbBtn.href  = fb ? fb : "#";
      if(!map) mapBtn.classList.add("opacity-40","pointer-events-none");
      if(!fb)  fbBtn.classList.add("opacity-40","pointer-events-none");

      const thumb = cleanUrl(d.Thumbnail_Image || d.thumbnail || "");
      const listRaw = cleanUrl(d.Image_List || d.image_list || "");
      const list = listRaw ? listRaw.split(",").map(s => cleanUrl(s)).filter(Boolean) : [];

      const seen = new Set();
      images = [];
      [thumb, ...list].forEach(u => {
        if(u && !seen.has(u)){
          seen.add(u);
          images.push(u);
        }
      });

      if(!images.length){
        images = ["https://via.placeholder.com/1200x700?text=No+Image"];
      }

      renderThumbs();
      enableSwipe();
      showApp();

      setMain(0);

      document.getElementById("prevBtn").addEventListener("click", () => setMain(current - 1));
      document.getElementById("nextBtn").addEventListener("click", () => setMain(current + 1));

      window.addEventListener("keydown", (e) => {
        if(e.key === "ArrowLeft") setMain(current - 1);
        if(e.key === "ArrowRight") setMain(current + 1);
      });

    }catch(err){
      errBox.classList.remove("hidden");
      showApp();
    }
  }

  load();
</script>
</body>
</html>
