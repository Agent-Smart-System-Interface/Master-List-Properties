<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Properties System · Details</title>

  <link rel="preconnect" href="https://script.google.com">
  <link rel="preconnect" href="https://lh3.googleusercontent.com">

  <style>
    :root{
      --bg:#a8bdd6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7c93;
      --radius:22px;
      --shadow: 0 12px 30px rgba(0,0,0,.12);
      --soft:#f3f6fb;
      --line:rgba(255,255,255,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Thai", sans-serif;
      background: radial-gradient(ellipse at top, rgba(255,255,255,.25), rgba(255,255,255,0) 55%) , var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px 14px 30px;}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px;
      border-radius: 18px;
      background: rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
      border: 1px solid var(--line);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:44px; height:44px; border-radius:999px; background:rgba(255,255,255,.55);
      display:grid; place-items:center; font-weight:800;
      flex:0 0 auto;
    }
    .titles h1{
      margin:0; font-size:20px; line-height:1.15; font-weight:1100;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .backBtn{
      width:44px; height:44px; border-radius:999px;
      border:0; background: rgba(255,255,255,.55);
      cursor:pointer; font-size:18px; font-weight:900;
    }

    .card{
      margin-top:14px; background: rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.65);
      border-radius: var(--radius); shadow: var(--shadow);
      overflow:hidden;
    }

    .gallery{ position:relative; background:#dfe9f6; }
    .mainSlide{ width:100%; aspect-ratio: 16/10; object-fit:cover; display:block; }

    .tagTopLeft{
      position:absolute; padding:8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.78); font-weight:1100; font-size:14px;
      left:14px; top:14px; backdrop-filter: blur(8px);
    }

    .tagBottomRight{
      position:absolute; right:14px; bottom:14px; font-weight:1100;
      font-size:14px; color: rgba(255,255,255,.98); text-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    .thumbStrip{ background: rgba(255,255,255,.78); padding:10px; display:flex; gap:10px; overflow:auto; }
    .thumb{ width:92px; height:64px; flex:0 0 auto; border-radius: 16px; object-fit:cover; cursor:pointer; border:3px solid transparent; }
    .thumb.active{ border-color:#0f172a; }

    .content{ padding:14px; }
    .price{ font-size:28px; font-weight:1100; }
    .statusBelow{
      display:inline-flex; padding:8px 12px; border-radius: 12px;
      font-weight:1100; background: rgba(255,255,255,.92); border: 2px solid #10b981; color: #059669;
    }

    /* ✅ จุดที่ 1: เฉพาะข้อมูล Description (ไม่มีหัวข้อ) */
    .descBox{
      margin-top:12px; padding:15px; background: rgba(15,23,42,0.03);
      border-radius: 18px; line-height:1.6; font-weight:500; color: #334155;
    }

    /* ✅ จุดที่ 3: Map Styling */
    .mapContainer{
      margin-top:14px; border-radius: 18px; overflow:hidden;
      border: 1px solid rgba(15,23,42,0.1); height: 300px; background: #e2e8f0;
    }
    .mapContainer.hidden { display: none !important; }
    iframe { width: 100%; height: 100%; border: 0; }

    .gridInfo{ margin-top:14px; display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px; }
    .infoBox{ background: rgba(15,23,42,.05); border-radius: 15px; padding:12px; display:flex; justify-content:space-between; }
    .k{ color:rgba(15,23,42,.55); font-weight:700; font-size: 13px; }
    .v{ color:rgba(15,23,42,.95); font-weight:1100; }

    .navArrow{
      position:absolute; top:50%; transform: translateY(-50%); width:44px; height:44px;
      border-radius: 999px; background: rgba(255,255,255,0.5); display:grid; place-items:center; cursor:pointer; z-index:5;
    }
    .navLeft{ left:10px; } .navRight{ right:10px; }

    /* Bottom Dock */
    .bottomDock{ position:fixed; bottom:0; left:0; right:0; background:rgba(255,255,255,0.8); backdrop-filter:blur(10px); padding:10px; border-top:1px solid #ddd; }
    .dockInner{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; max-width:1100px; margin:0 auto; }
    .dockBtn{ background:#fff; padding:10px; border-radius:15px; text-align:center; font-weight:800; text-decoration:none; color:#000; border:1px solid #eee; font-size:12px; }
    .dockBtn.disabled{ opacity:0.3; pointer-events:none; }
  </style>
</head>
<body>

  <div id="pageLoader" class="pageLoader" style="position:fixed; inset:0; background:#fff; z-index:999; display:flex; align-items:center; justify-content:center; font-weight:bold;">Loading...</div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo">HP</div><div class="titles"><h1 id="pageTitle">-</h1></div></div>
      <button class="backBtn" onclick="history.back()">←</button>
    </div>

    <div class="card">
      <div class="gallery" id="gallery">
        <img class="mainSlide" id="mainImg" src="" />
        <div class="tagTopLeft" id="tagPlot">-</div>
        <div class="tagBottomRight" id="tagCount">0 / 0</div>
        <div class="navArrow navLeft" onclick="changeSlide(-1)">❮</div>
        <div class="navArrow navRight" onclick="changeSlide(1)">❯</div>
      </div>
      <div class="thumbStrip" id="thumbStrip"></div>

      <div class="content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="price" id="priceText">฿0</div>
          <div class="statusBelow" id="statusBelow">-</div>
        </div>

        <div id="descBox" class="descBox"></div>

        <div id="mapWrap" class="mapContainer hidden"></div>

        <div class="gridInfo" id="infoGrid"></div>
      </div>
    </div>
  </div>

  <div class="bottomDock">
    <div class="dockInner">
      <a id="dockSales" class="dockBtn disabled" href="#" target="_blank">Sales PDF</a>
      <a id="dockMaterial" class="dockBtn disabled" href="#" target="_blank">Material PDF</a>
      <a id="dockFloor" class="dockBtn disabled" href="#" target="_blank">Floor Plan</a>
    </div>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxvzszMpjb1Dy3nQDhh64oPYu1-CgL-RSdRe52Df_pejfqkhq-g70z96npgaSyNAw2T/exec";
const params = new URLSearchParams(location.search);
const hpId = params.get("id");
const project = params.get("project") || "HP00";

let images = [];
let currentIdx = 0;

async function init() {
    if(!hpId) return alert("No ID found");
    try {
        const res = await fetch(`${SCRIPT_URL}?mode=getUnitDetail&hpId=${hpId}&project=${project}`);
        const data = await res.json();
        render(data);
    } catch (e) { console.error(e); }
    document.getElementById("pageLoader").style.display = "none";
}

function render(data) {
    document.getElementById("pageTitle").textContent = `Plot: ${data.Plot || '-'}`;
    document.getElementById("tagPlot").textContent = data.Plot || '-';
    document.getElementById("priceText").textContent = "฿" + Number(data.Price).toLocaleString();
    document.getElementById("statusBelow").textContent = data.Status;

    // ✅ จุดที่ 1: Description
    document.getElementById("descBox").textContent = data.Description || "-";

    // ✅ จุดที่ 3: Smart Map Logic
    const mapWrap = document.getElementById("mapWrap");
    if (data.Map_Link && data.Map_Link !== "#" && data.Map_Link.length > 10) {
        mapWrap.classList.remove("hidden");
        // แปลงลิงก์เป็น Embed
        let embedUrl = data.Map_Link;
        if(embedUrl.includes("maps.app.goo.gl") || embedUrl.includes("goo.gl/maps")) {
            mapWrap.innerHTML = `<iframe src="https://www.google.com/maps?q=${encodeURIComponent(data.Address || 'Thailand')}&output=embed"></iframe>`;
        } else {
            mapWrap.innerHTML = `<iframe src="${embedUrl}"></iframe>`;
        }
    }

    // ✅ จุดที่ 2 & 4: Data Mapping (แยก Land/Living และดึง sq.m)
    const grid = document.getElementById("infoGrid");
    const info = [
        ["Project", data.Project_Name],
        ["Bedrooms", data.Bedrooms],
        ["Bathrooms", data.Bathrooms],
        ["Land Area (sq.w)", data.Land_Area_sq_w],
        ["Living Area (sq.m)", (data.Living_Area_sq_m || data.LivingArea_sq_m) + " sq.m"],
        ["Land (sq.m)", (data.Land_Area_sq_m || data.LandArea_sq_m) + " sq.m"],
        ["Living (sq.m)", (data.Living_Area_sq_m || data.LivingArea_sq_m) + " sq.m"],
        ["Furnishing", data.Furnishing],
        ["Zone", data.Zone]
    ];
    
    grid.innerHTML = info.map(item => `
        <div class="infoBox">
            <span class="k">${item[0]}</span>
            <span class="v">${item[1] || '-'}</span>
        </div>
    `).join("");

    // Images
    const thumb = data.Thumbnail_Image;
    const list = data.Image_List ? data.Image_List.split(",") : [];
    images = [thumb, ...list].filter(Boolean);
    updateGallery();

    // PDF Buttons
    setupPDF("dockSales", data.Sales_Gallery);
    setupPDF("dockMaterial", data.Material_PDF);
    setupPDF("dockFloor", data.Floor_Plan);
}

function setupPDF(id, url) {
    const el = document.getElementById(id);
    if(url && url.startsWith("http")) {
        el.href = url;
        el.classList.remove("disabled");
    }
}

function updateGallery() {
    document.getElementById("mainImg").src = images[currentIdx];
    document.getElementById("tagCount").textContent = `${currentIdx + 1} / ${images.length}`;
    const strip = document.getElementById("thumbStrip");
    strip.innerHTML = images.map((img, i) => `
        <img class="thumb ${i===currentIdx?'active':''}" src="${img}" onclick="setSlide(${i})">
    `).join("");
}

function setSlide(i) { currentIdx = i; updateGallery(); }
function changeSlide(n) {
    currentIdx = (currentIdx + n + images.length) % images.length;
    updateGallery();
}

init();
</script>
</body>
</html>
