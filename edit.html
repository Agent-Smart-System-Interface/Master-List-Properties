<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8"><title>PROPERTY EDITOR | PROJECT_0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Kanit', sans-serif; background: #f8fafc; } .field-input { width: 100%; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.8rem; outline: none; }</style>
</head>
<body class="p-4 md:p-10 italic">
    <div class="max-w-5xl mx-auto bg-white rounded-[3rem] shadow-2xl overflow-hidden">
        <div class="bg-slate-900 p-10 text-white flex justify-between items-center">
            <div><p class="text-[10px] text-blue-400 font-bold uppercase tracking-widest">Master Database Editor</p><h1 id="displayId" class="text-4xl font-bold tracking-tighter italic">HP-XXXX</h1></div>
            <button onclick="window.history.back()" class="bg-white/10 p-4 rounded-2xl"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="mainForm" class="p-10 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div><span class="text-[10px] font-bold text-slate-400">UNIT ID (READ ONLY)</span><input id="HP_ID" class="field-input bg-slate-50" readonly></div>
                <div><span class="text-[10px] font-bold text-slate-400">PLOT</span><input id="Plot" class="field-input"></div>
                <div><span class="text-[10px] font-bold text-slate-400">TYPE</span><input id="Type" class="field-input"></div>
                <div class="col-span-full"><span class="text-[10px] font-bold text-slate-400">PROJECT NAME</span><input id="Project_Name" class="field-input text-blue-600 font-bold"></div>
                </div>
            <button onclick="updateData()" id="saveBtn" class="w-full py-7 bg-slate-900 text-white rounded-[2.5rem] font-bold uppercase tracking-[0.4em] shadow-2xl hover:bg-blue-600 transition-all">Update Database</button>
        </div>
    </div>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxJ_QwwXW7sV8dmAH0J6mzBV5QWMjxm_MWpL74JC6iJUzgikHtt31HNG-koRtzd8AGJ/exec";
        const params = new URLSearchParams(window.location.search);
        const HP_ID = params.get('id');
        const PROJECT = params.get('project');

        async function init() {
            document.getElementById('displayId').innerText = HP_ID;
            const res = await fetch(`${API_URL}?mode=getUnitDetail&hpId=${HP_ID}&project=${PROJECT}&t=${Date.now()}`);
            const d = await res.json();
            // ✅ บังคับให้ช่อง HP_ID แสดงผลตามที่ดึงมา
            Object.keys(d).forEach(k => { if(document.getElementById(k)) document.getElementById(k).value = d[k]; });
        }
        
        async function updateData() {
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerText = "UPDATING...";
            const payload = { mode: "updateUnit", project: PROJECT, hpId: HP_ID, Plot: document.getElementById('Plot').value, Type: document.getElementById('Type').value, Project_Name: document.getElementById('Project_Name').value };
            await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
            alert("บันทึกสำเร็จ!"); window.history.back();
        }
        window.onload = init;
    </script>
</body>
</html>
