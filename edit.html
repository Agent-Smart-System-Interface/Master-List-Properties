<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FULL PROPERTY EDITOR | MASTER SYSTEM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Kanit',sans-serif;background:#f0f2f5}
    .tab-active{border-bottom:4px solid #1e293b;color:#1e293b}
    .input-card{background:white;padding:1.5rem;border-radius:1.5rem;box-shadow:0 4px 6px -1px rgba(0,0,0,.1)}
    .field-label{font-size:.75rem;font-weight:700;color:#64748b;text-transform:uppercase;margin-bottom:.5rem;display:block}
    .field-input{width:100%;border:1px solid #e2e8f0;border-radius:.75rem;padding:.75rem}
    .field-input[disabled]{background:#f8fafc;opacity:.75;cursor:not-allowed}
  </style>
</head>

<body class="p-4 md:p-10 italic">
<div class="max-w-5xl mx-auto">

  <!-- HEADER -->
  <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white flex justify-between items-center mb-8">
    <div>
      <p class="text-blue-400 font-bold text-xs">MASTER DATABASE EDITOR</p>
      <h1 id="displayId" class="text-3xl font-bold">HP-XXXX</h1>
    </div>
    <button onclick="history.back()" class="p-4 bg-white/10 rounded-xl">✕</button>
  </div>

  <!-- INFO -->
  <div class="input-card space-y-6">

    <!-- STATUS (แก้ได้) -->
    <div>
      <span class="field-label">Status</span>
      <select id="Status" class="field-input font-bold">
        <option value="Available">Available</option>
        <option value="Under Con">Under Con</option>
        <option value="Reserved">Reserved</option>
        <option value="Sold">Sold</option>
      </select>
    </div>

    <!-- SYSTEM STATUS (ดูได้อย่างเดียว) -->
    <div>
      <span class="field-label">System Status (Read Only)</span>
      <select id="System_Status" class="field-input font-bold" disabled>
        <option value="Offline">Offline</option>
        <option value="Pending">Pending</option>
        <option value="Online">Online</option>
      </select>
      <p class="text-xs text-slate-400 mt-1">
        * กำหนดโดย Master System เท่านั้น
      </p>
    </div>

  </div>

  <!-- SAVE -->
  <button onclick="updateData()" id="saveBtn"
    class="w-full mt-10 py-6 bg-slate-900 text-white rounded-[2rem] font-bold">
    UPDATE MASTER DATABASE
  </button>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";
const urlParams = new URLSearchParams(location.search);
const HP_ID = urlParams.get("id");
const PROJECT = urlParams.get("project");

async function loadData(){
  document.getElementById("displayId").innerText = HP_ID || "HP-XXXX";

  const res = await fetch(`${API_URL}?mode=getUnitDetail&hpId=${HP_ID}&project=${PROJECT}`);
  const data = await res.json();

  // Status (แก้ได้)
  if(data.Status){
    document.getElementById("Status").value = data.Status;
  }

  // System Status (ดูอย่างเดียว)
  if(data.System_Status){
    const map = {
      "Live":"Online",
      "Online (Live)":"Online",
      "Online":"Online",
      "Pending":"Pending",
      "Offline":"Offline"
    };
    const v = map[data.System_Status] || data.System_Status;
    document.getElementById("System_Status").value = v;
  }
}

async function updateData(){
  const payload = {
    mode:"updateUnit",
    project:PROJECT,
    hpId:HP_ID,
    Status:document.getElementById("Status").value
    // ❌ ไม่ส่ง System_Status
  };

  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify(payload)
  });

  alert("Saved");
}

window.onload = loadData;
</script>
</body>
</html>
