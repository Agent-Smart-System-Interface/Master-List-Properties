<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FULL EDIT SYSTEM - AGENT SMART</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Kanit', sans-serif; background: #fdfdfd; }</style>
</head>
<body class="p-4 md:p-10 italic">
    <div class="max-w-4xl mx-auto bg-white rounded-[3rem] shadow-2xl border border-slate-50 overflow-hidden">
        <div class="bg-[#0f172a] p-8 text-white flex justify-between items-center">
            <div>
                <p class="text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-1">Editing Unit Details</p>
                <h1 id="displayId" class="text-3xl font-bold italic underline">HP-A001</h1>
            </div>
            <button onclick="window.history.back()" class="bg-white/10 hover:bg-white/20 p-3 rounded-2xl transition-all font-bold text-xs uppercase">
                <i class="fa-solid fa-chevron-left mr-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
        </div>

        <div id="statusMessage" class="p-20 text-center text-slate-400 font-bold italic">
            <i class="fa-solid fa-spinner fa-spin text-2xl mb-4 text-blue-500"></i><br>
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master...
        </div>

        <div id="fullForm" class="hidden p-8 md:p-12 space-y-10">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Main Cover Image (URL)</label>
                    <input type="text" id="thumbnail_image" class="w-full p-4 bg-slate-50 rounded-xl outline-none text-xs border border-slate-100" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å">
                    <label class="flex flex-col items-center p-6 bg-blue-50/50 border-2 border-dashed border-blue-200 rounded-2xl cursor-pointer">
                        <i class="fa-solid fa-cloud-arrow-up text-blue-600 mb-2"></i>
                        <span class="text-[9px] font-bold text-blue-600">UPLOAD NEW COVER</span>
                        <input type="file" id="file_thumb" class="hidden">
                    </label>
                </div>
                <div class="space-y-4">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Gallery Album (URLs Separated by Comma)</label>
                    <textarea id="gallery_images" class="w-full p-4 bg-slate-50 rounded-xl outline-none text-[10px] border border-slate-100 h-28" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° ‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤"></textarea>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 italic">
                <div class="space-y-2 col-span-full">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Property Name / Heading</label>
                    <input type="text" id="id_name" class="w-full p-5 bg-white border border-slate-100 rounded-2xl outline-none font-bold text-slate-800 text-lg shadow-sm">
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4">Plot Name</label>
                    <input type="text" id="plot" class="w-full p-4 bg-slate-50 rounded-xl outline-none text-sm">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4">Property Type</label>
                    <input type="text" id="type" class="w-full p-4 bg-slate-50 rounded-xl outline-none text-sm">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Sale Price (‡∏ø)</label>
                    <input type="number" id="price" class="w-full p-4 bg-blue-50 text-blue-700 font-bold rounded-xl outline-none text-xl border border-blue-100">
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Sale Status</label>
                    <select id="sale_status" class="w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-xs uppercase">
                        <option value="AVAILABLE">üü¢ AVAILABLE</option>
                        <option value="SOLD">üî¥ SOLD</option>
                        <option value="RESERVED">üü£ RESERVED</option>
                        <option value="UNDER CON">üü† UNDER CON</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">System Visibility</label>
                    <select id="system_status" class="w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-xs uppercase">
                        <option value="Live">‚úÖ Live (Online)</option>
                        <option value="Offline">‚ùå Offline</option>
                        <option value="Pending">‚ö†Ô∏è Pending</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-4 italic">Project Tab</label>
                    <input type="text" id="project_tab" class="w-full p-4 bg-slate-200 rounded-xl outline-none text-xs font-bold" readonly>
                </div>
            </div>

            <div class="space-y-4 italic">
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-4">Detailed Description (Full Details)</label>
                <textarea id="description" rows="6" class="w-full p-6 bg-slate-50 rounded-[2.5rem] outline-none text-sm border border-slate-100 shadow-inner"></textarea>
            </div>

            <button onclick="updateMaster()" id="btnSave" class="w-full bg-[#0f172a] text-white py-6 rounded-[2.5rem] font-bold uppercase tracking-[0.3em] shadow-2xl hover:bg-blue-600 transition-all active:scale-95 italic">
                <i class="fa-solid fa-floppy-disk mr-3 text-xl"></i> Confirm Update to Master Hub
            </button>
        </div>
    </div>

    <script>
        // üõë ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const API_URL = "https://script.google.com/macros/s/AKfycbwe5Sfa4aN_17nmtgekfP4CpHXVmlL4NOpzc7cG2zvffnrgpA5u9tUNmKGnZNUpz29u/exec"; 

        const urlParams = new URLSearchParams(window.location.search);
        const HP_ID = urlParams.get('id');
        const PROJECT = urlParams.get('project');

        async function init() {
            if(!HP_ID || !PROJECT) {
                document.getElementById('statusMessage').innerHTML = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏´‡∏±‡∏™‡∏ö‡πâ‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå";
                return;
            }
            document.getElementById('displayId').innerText = HP_ID;
            document.getElementById('project_tab').value = PROJECT;

            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° Google Script
                const response = await fetch(`${API_URL}?mode=getUnitDetail&hpId=${HP_ID}&project=${PROJECT}`);
                const data = await response.json();

                if(data.HP_ID) {
                    // ‡πÅ‡∏°‡∏û‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠ ID ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó)
                    document.getElementById('id_name').value = data.ID_NAME || "";
                    document.getElementById('plot').value = data.Plot || "";
                    document.getElementById('type').value = data.Type || "";
                    document.getElementById('price').value = data.Price || 0;
                    document.getElementById('sale_status').value = data.Sale_Status || "AVAILABLE";
                    document.getElementById('system_status').value = data.System_Status || "Live";
                    document.getElementById('description').value = data.Description || "";
                    document.getElementById('thumbnail_image').value = data.Thumbnail_Image || "";
                    document.getElementById('gallery_images').value = data.Gallery_Images || "";

                    document.getElementById('statusMessage').classList.add('hidden');
                    document.getElementById('fullForm').classList.remove('hidden');
                } else {
                    throw new Error("Data Empty");
                }
            } catch (e) {
                document.getElementById('statusMessage').innerHTML = `‚ö†Ô∏è ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${PROJECT} ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br><span class="text-[10px]">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏ô Google Sheets</span>`;
            }
        }

        async function updateMaster() {
            const btn = document.getElementById('btnSave');
            btn.disabled = true; btn.innerHTML = "üîÑ UPDATING...";
            
            const payload = {
                mode: "updateUnit",
                project: PROJECT,
                hpId: HP_ID,
                idName: document.getElementById('id_name').value,
                price: document.getElementById('price').value,
                saleStatus: document.getElementById('sale_status').value,
                sysStatus: document.getElementById('system_status').value,
                description: document.getElementById('description').value,
                thumbnail: document.getElementById('thumbnail_image').value,
                gallery: document.getElementById('gallery_images').value
            };

            try {
                await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                window.history.back();
            } catch (e) {
                alert("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                btn.disabled = false; btn.innerHTML = "RETRY UPDATE";
            }
        }

        window.onload = init;
    </script>
</body>
</html>
