<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>EDIT PROPERTY STATUS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Kanit', sans-serif;
      background: #f1f5f9;
    }
  </style>
</head>

<body class="p-6 md:p-10">

  <!-- CONTAINER -->
  <div class="max-w-xl mx-auto bg-white rounded-3xl shadow-xl p-8">

    <!-- TITLE -->
    <h1 class="text-2xl font-bold text-slate-800 mb-6">
      Edit Unit Status
    </h1>

    <!-- STATUS FIELD -->
    <div class="mb-8">
      <label
        for="Status"
        class="block mb-2 text-sm font-bold text-slate-500 uppercase tracking-wide"
      >
        Status
      </label>

      <select
        id="Status"
        class="w-full px-5 py-4 rounded-xl border border-slate-200
               bg-white text-slate-800 font-bold
               focus:outline-none focus:ring-2 focus:ring-slate-900 transition-all"
      >
        <option value="Available">Available</option>
        <option value="Under Con">Under Con</option>
        <option value="Reserved">Reserved</option>
        <option value="Sold">Sold</option>
      </select>
    </div>

    <!-- SAVE BUTTON -->
    <button
      onclick="updateStatus()"
      class="w-full py-5 bg-slate-900 text-white rounded-2xl
             font-bold uppercase tracking-widest
             hover:bg-slate-700 transition-all"
    >
      Update Status
    </button>

  </div>

  <!-- SCRIPT -->
  <script>
    // ===============================
    // CONFIG
    // ===============================
    const API_URL = "https://script.google.com/macros/s/AKfycbwvCiaEKxvRI9rQCXMR_F4SHqmkJT4CnAuoVgEr6RYACmfgKerp7r06m-ltBMu4GFD4/exec";

    const params = new URLSearchParams(window.location.search);
    const HP_ID = params.get("id");
    const PROJECT = params.get("project");

    // ===============================
    // LOAD DATA
    // ===============================
    async function loadData() {
      try {
        const res = await fetch(
          `${API_URL}?mode=getUnitDetail&hpId=${HP_ID}&project=${PROJECT}`
        );
        const data = await res.json();

        if (data.Status) {
          document.getElementById("Status").value = data.Status;
        }
      } catch (err) {
        alert("ไม่สามารถโหลดข้อมูลได้");
        console.error(err);
      }
    }

    // ===============================
    // UPDATE STATUS
    // ===============================
    async function updateStatus() {
      const payload = {
        mode: "updateStatus",
        project: PROJECT,
        hpId: HP_ID,
        Status: document.getElementById("Status").value
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          alert("บันทึกสถานะเรียบร้อยแล้ว");
          window.history.back();
        } else {
          alert("บันทึกไม่สำเร็จ");
        }
      } catch (err) {
        alert("เกิดข้อผิดพลาด");
        console.error(err);
      }
    }

    window.onload = loadData;
  </script>

</body>
</html>
